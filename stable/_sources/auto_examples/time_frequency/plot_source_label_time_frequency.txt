

.. _sphx_glr_auto_examples_time_frequency_plot_source_label_time_frequency.py:


=========================================================
Compute power and phase lock in label of the source space
=========================================================

Compute time-frequency maps of power and phase lock in the source space.
The inverse method is linear based on dSPM inverse operator.

The example also shows the difference in the time-frequency maps
when they are computed with and without subtracting the evoked response
from each epoch. The former results in induced activity only while the
latter also includes evoked (stimulus-locked) activity.


.. code-block:: python

    # Authors: Alexandre Gramfort <alexandre.gramfort@telecom-paristech.fr>
    #
    # License: BSD (3-clause)

    import numpy as np
    import matplotlib.pyplot as plt

    import mne
    from mne import io
    from mne.datasets import sample
    from mne.minimum_norm import read_inverse_operator, source_induced_power

    print(__doc__)




.. rst-class:: sphx-glr-horizontal





Set parameters


.. code-block:: python

    data_path = sample.data_path()
    raw_fname = data_path + '/MEG/sample/sample_audvis_raw.fif'
    fname_inv = data_path + '/MEG/sample/sample_audvis-meg-oct-6-meg-inv.fif'
    label_name = 'Aud-rh'
    fname_label = data_path + '/MEG/sample/labels/%s.label' % label_name

    tmin, tmax, event_id = -0.2, 0.5, 2

    # Setup for reading the raw data
    raw = io.Raw(raw_fname)
    events = mne.find_events(raw, stim_channel='STI 014')
    inverse_operator = read_inverse_operator(fname_inv)

    include = []
    raw.info['bads'] += ['MEG 2443', 'EEG 053']  # bads + 2 more

    # Picks MEG channels
    picks = mne.pick_types(raw.info, meg=True, eeg=False, eog=True,
                           stim=False, include=include, exclude='bads')
    reject = dict(grad=4000e-13, mag=4e-12, eog=150e-6)

    # Load epochs
    epochs = mne.Epochs(raw, events, event_id, tmin, tmax, picks=picks,
                        baseline=(None, 0), reject=reject,
                        preload=True)

    # Compute a source estimate per frequency band including and excluding the
    # evoked response
    frequencies = np.arange(7, 30, 2)  # define frequencies of interest
    label = mne.read_label(fname_label)
    n_cycles = frequencies / 3.  # different number of cycle per frequency

    # subtract the evoked response in order to exclude evoked activity
    epochs_induced = epochs.copy().subtract_evoked()

    plt.close('all')

    for ii, (this_epochs, title) in enumerate(zip([epochs, epochs_induced],
                                                  ['evoked + induced',
                                                   'induced only'])):
        # compute the source space power and phase lock
        power, phase_lock = source_induced_power(
            this_epochs, inverse_operator, frequencies, label, baseline=(-0.1, 0),
            baseline_mode='percent', n_cycles=n_cycles, n_jobs=1)

        power = np.mean(power, axis=0)  # average over sources
        phase_lock = np.mean(phase_lock, axis=0)  # average over sources
        times = epochs.times

        ##########################################################################
        # View time-frequency plots
        plt.subplots_adjust(0.1, 0.08, 0.96, 0.94, 0.2, 0.43)
        plt.subplot(2, 2, 2 * ii + 1)
        plt.imshow(20 * power,
                   extent=[times[0], times[-1], frequencies[0], frequencies[-1]],
                   aspect='auto', origin='lower', vmin=0., vmax=30., cmap='RdBu_r')
        plt.xlabel('Time (s)')
        plt.ylabel('Frequency (Hz)')
        plt.title('Power (%s)' % title)
        plt.colorbar()

        plt.subplot(2, 2, 2 * ii + 2)
        plt.imshow(phase_lock,
                   extent=[times[0], times[-1], frequencies[0], frequencies[-1]],
                   aspect='auto', origin='lower', vmin=0, vmax=0.7,
                   cmap='RdBu_r')
        plt.xlabel('Time (s)')
        plt.ylabel('Frequency (Hz)')
        plt.title('Phase-lock (%s)' % title)
        plt.colorbar()

    plt.show()



.. image:: /auto_examples/time_frequency/images/sphx_glr_plot_source_label_time_frequency_001.png
    :align: center


**Script output**:

.. rst-class:: sphx-glr-script-out

  ::

    Opening raw data file /home/jaakko/examples/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
        Read a total of 3 projection items:
            PCA-v1 (1 x 102)  idle
            PCA-v2 (1 x 102)  idle
            PCA-v3 (1 x 102)  idle
    Current compensation grade : 0
        Range : 25800 ... 192599 =     42.956 ...   320.670 secs
    Ready.
    Adding average EEG reference projection.
    1 projection items deactivated
    Reading 0 ... 166799  =      0.000 ...   277.714 secs...
    [done]
    320 events found
    Events id: [ 1  2  3  4  5 32]
    Reading inverse operator decomposition from /home/jaakko/examples/MNE-sample-data/MEG/sample/sample_audvis-meg-oct-6-meg-inv.fif...
        Reading inverse operator info...
        [done]
        Reading inverse operator decomposition...
        [done]
        305 x 305 full covariance (kind = 1) found.
        Read a total of 4 projection items:
            PCA-v1 (1 x 102) active
            PCA-v2 (1 x 102) active
            PCA-v3 (1 x 102) active
            Average EEG reference (1 x 60) active
        Noise covariance matrix read.
        22494 x 22494 diagonal covariance (kind = 2) found.
        Source covariance matrix read.
        22494 x 22494 diagonal covariance (kind = 6) found.
        Orientation priors read.
        22494 x 22494 diagonal covariance (kind = 5) found.
        Depth priors read.
        Did not find the desired covariance matrix (kind = 3)
        Reading a source space...
        Computing patch statistics...
        Patch information added...
        Distance information added...
        [done]
        Reading a source space...
        Computing patch statistics...
        Patch information added...
        Distance information added...
        [done]
        2 source spaces read
        Read a total of 4 projection items:
            PCA-v1 (1 x 102) active
            PCA-v2 (1 x 102) active
            PCA-v3 (1 x 102) active
            Average EEG reference (1 x 60) active
        Source spaces transformed to the inverse solution coordinate frame
    73 matching events found
    Created an SSP operator (subspace dimension = 3)
    4 projection items activated
    Reading 2057 ... 2477  =      3.425 ...     4.124 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 3732 ... 4152  =      6.214 ...     6.913 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 5320 ... 5740  =      8.858 ...     9.557 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 7015 ... 7435  =     11.680 ...    12.379 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 8612 ... 9032  =     14.339 ...    15.038 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 10291 ... 10711  =     17.134 ...    17.833 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 11990 ... 12410  =     19.963 ...    20.662 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 13643 ... 14063  =     22.715 ...    23.414 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 15340 ... 15760  =     25.540 ...    26.240 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 17040 ... 17460  =     28.371 ...    29.070 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 18729 ... 19149  =     31.183 ...    31.882 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 20320 ... 20740  =     33.832 ...    34.531 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 21975 ... 22395  =     36.587 ...    37.287 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 23549 ... 23969  =     39.208 ...    39.907 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 25126 ... 25546  =     41.834 ...    42.533 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 26755 ... 27175  =     44.546 ...    45.245 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 28400 ... 28820  =     47.285 ...    47.984 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 29958 ... 30378  =     49.879 ...    50.578 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 31692 ... 32112  =     52.766 ...    53.465 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 35115 ... 35535  =     58.465 ...    59.164 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 36762 ... 37182  =     61.207 ...    61.907 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 38467 ... 38887  =     64.046 ...    64.745 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 40151 ... 40571  =     66.850 ...    67.549 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 41891 ... 42311  =     69.747 ...    70.446 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 43538 ... 43958  =     72.489 ...    73.188 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 45208 ... 45628  =     75.270 ...    75.969 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 46904 ... 47324  =     78.093 ...    78.793 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 48620 ... 49040  =     80.950 ...    81.650 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 50166 ... 50586  =     83.524 ...    84.224 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 51762 ... 52182  =     86.182 ...    86.881 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 53441 ... 53861  =     88.977 ...    89.676 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 55097 ... 55517  =     91.734 ...    92.434 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 56795 ... 57215  =     94.561 ...    95.261 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 58526 ... 58946  =     97.443 ...    98.143 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 60187 ... 60607  =    100.209 ...   100.908 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 61804 ... 62224  =    102.901 ...   103.600 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 63576 ... 63996  =    105.852 ...   106.551 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 65274 ... 65694  =    108.679 ...   109.378 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 68621 ... 69041  =    114.251 ...   114.951 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 70409 ... 70829  =    117.228 ...   117.927 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on MAG : [u'MEG 1711']
    Reading 72193 ... 72613  =    120.198 ...   120.898 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 73875 ... 74295  =    122.999 ...   123.698 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 75548 ... 75968  =    125.784 ...   126.484 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 77272 ... 77692  =    128.655 ...   129.354 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 78989 ... 79409  =    131.514 ...   132.213 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 80700 ... 81120  =    134.362 ...   135.062 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 82250 ... 82670  =    136.943 ...   137.642 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 83821 ... 84241  =    139.559 ...   140.258 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 85520 ... 85940  =    142.387 ...   143.087 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 87220 ... 87640  =    145.218 ...   145.917 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 88820 ... 89240  =    147.882 ...   148.581 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 90607 ... 91027  =    150.857 ...   151.556 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 93776 ... 94196  =    156.133 ...   156.833 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 95472 ... 95892  =    158.957 ...   159.656 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 97145 ... 97565  =    161.743 ...   162.442 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 98910 ... 99330  =    164.681 ...   165.380 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 100626 ... 101046  =    167.538 ...   168.238 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 102155 ... 102575  =    170.084 ...   170.783 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 103812 ... 104232  =    172.843 ...   173.542 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 105333 ... 105753  =    175.375 ...   176.075 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 107054 ... 107474  =    178.241 ...   178.940 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 108809 ... 109229  =    181.163 ...   181.862 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 110365 ... 110785  =    183.753 ...   184.453 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 112073 ... 112493  =    186.597 ...   187.296 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 113817 ... 114237  =    189.501 ...   190.200 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 115642 ... 116062  =    192.539 ...   193.239 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 117298 ... 117718  =    195.296 ...   195.996 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 118996 ... 119416  =    198.124 ...   198.823 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 120625 ... 121045  =    200.836 ...   201.535 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 122384 ... 122804  =    203.764 ...   204.464 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 124069 ... 124489  =    206.570 ...   207.269 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 125706 ... 126126  =    209.295 ...   209.995 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 127291 ... 127711  =    211.934 ...   212.634 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    14 bad epochs dropped
    Subtracting Evoked from Epochs
        The following channels are not included in the subtraction: EOG 061
    [done]
    Preparing the inverse operator for use...
        Scaled noise and source covariance from nave = 1 to nave = 1
        Created the regularized inverter
        Created an SSP operator (subspace dimension = 3)
        Created the whitener using a full noise covariance matrix (3 small eigenvalues omitted)
        Computing noise-normalization factors (dSPM)...
    [done]
    Picked 305 channels from the data
    Computing inverse...
    (eigenleads need to be weighted)...
    Reducing data rank to 81
    Computing source power ...
    Applying baseline correction ... (mode: percent)
    Preparing the inverse operator for use...
        Scaled noise and source covariance from nave = 1 to nave = 1
        Created the regularized inverter
        Created an SSP operator (subspace dimension = 3)
        Created the whitener using a full noise covariance matrix (3 small eigenvalues omitted)
        Computing noise-normalization factors (dSPM)...
    [done]
    Picked 305 channels from the data
    Computing inverse...
    (eigenleads need to be weighted)...
    Reducing data rank to 81
    Computing source power ...
    Applying baseline correction ... (mode: percent)


**Total running time of the script:**
(0 minutes 31.165 seconds)



**Download Python source code:** :download:`plot_source_label_time_frequency.py <plot_source_label_time_frequency.py>`
