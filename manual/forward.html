<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The forward solution &mdash; MNE 0.9.dev0 documentation</title>
    
    <link rel="stylesheet" href="../_static/navy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="MNE 0.9.dev0 documentation" href="../index.html" />
    <link rel="up" title="Manual" href="../manual.html" />
    <link rel="next" title="The current estimates" href="mne.html" />
    <link rel="prev" title="Processing raw data" href="browse.html" />

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>



    <script type="text/javascript">
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);
    js.id=id;js.src="http://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>



    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>


  </head>
  <body>

<div style="background-color: red; color: white; font-weight:bold; text-align: center; padding: 10px; min-width: 910px">
This documentation is for the development version (0.9.dev0) - <a href="http://martinos.org/mne/stable">Stable version</a>
</div>

<div style="background-color: white; text-align: left; padding: 10px 7px 15px 15px; min-width: 910px">
<div style="float: left">
<a href="../index.html"><img src="../_static/mne_logo.png" border="0" alt="py4sci"/></a>
</div>

<div style="float: right">
<a href="../index.html"><img src="../_static/institutions.png" border="0" alt="py4sci"/></a>
</div>
<br style="clear:both"/>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../np-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="mne.html" title="The current estimates"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="browse.html" title="Processing raw data"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Home</a>&nbsp;|&nbsp;</li>
        <li><a href="../manual.html">Manual</a>&nbsp;|&nbsp;</li>
        <li><a href="../mne-python.html">Python</a>&nbsp;|&nbsp;</li>
        <li><a href="../cite.html">Cite MNE</a>&nbsp;|&nbsp;</li>
        <!-- <li><a href="../search.html">Search</a></li> -->

          <li><a href="../manual.html" accesskey="U">Manual</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../manual.html">Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="list.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html">The Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="browse.html">Processing raw data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">The forward solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="mne.html">The current estimates</a></li>
<li class="toctree-l2"><a class="reference internal" href="analyze.html">Interactive analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="morph.html">Morphing and averaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="convert.html">Data conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="matlab.html">The Matlab toolbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Miscellaneous utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="sampledata.html">The sample data set</a></li>
<li class="toctree-l2"><a class="reference internal" href="reading.html">Related publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="AppA.html">Creating the BEM meshes</a></li>
<li class="toctree-l2"><a class="reference internal" href="AppB.html">Setup at the Martinos Center</a></li>
<li class="toctree-l2"><a class="reference internal" href="AppInstall.html">Installation and configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="AppReleaseNotes.html">Release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="AppEULA.html">Licence agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../command_line_tutorial.html">Getting started with MNE command line</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mne-python.html">MNE with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mne-cpp.html">MNE with CPP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cite.html">Cite MNE and MNE-Python</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Versions</h3>
<ul class="current">
    <li class="toctree-l1"><a href=http://martinos.org/mne/stable>Stable</a></li>
    <li class="toctree-l1"><a href=http://martinos.org/mne/dev>Development</a></li>
</ul>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-forward-solution">
<span id="ch-forward"></span><h1>The forward solution<a class="headerlink" href="#the-forward-solution" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This Chapter covers the definitions of different coordinate
systems employed in MNE software and FreeSurfer, the details of
the computation of the forward solutions, and the associated low-level
utilities.</p>
</div>
<div class="section" id="meg-eeg-and-mri-coordinate-systems">
<span id="chdedfib"></span><h2>MEG/EEG and MRI coordinate systems<a class="headerlink" href="#meg-eeg-and-mri-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<p>The coordinate systems used in MNE software (and FreeSurfer)
and their relationships are depicted in <a class="reference internal" href="#chdffjij"><em>MEG/EEG and MRI coordinate systems</em></a>.
Except for the <em>Sensor coordinates</em>, all of the
coordinate systems are Cartesian and have the &#8220;RAS&#8221; (Right-Anterior-Superior)
orientation, <em>i.e.</em>, the <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> axis
points to the right, the <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> axis
to the front, and the <img class="math" src="../_images/math/84d7271dd9e78c1e05d6c3c6ecb60309ef7dfc73.png" alt="z"/> axis up.</p>
<div class="figure" id="chdffjij">
<img alt="MEG/EEG and MRI coordinate systems" src="../_images/CoordinateSystems.png" />
<p class="caption">MEG/EEG and MRI coordinate systems</p>
<div class="legend">
The coordinate transforms present in the fif files in MNE and the FreeSurfer files as well as those set to fixed values are indicated with <img class="math" src="../_images/math/d9424729510343e6830d47e1a146990c7b7ed661.png" alt="T_x"/>, where <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> identifies the transformation.</div>
</div>
<p>The coordinate systems related
to MEG/EEG data are:</p>
<p><strong>Head coordinates</strong></p>
<blockquote>
<div>This is a coordinate system defined with help of the fiducial landmarks
(nasion and the two auricular points). In fif files, EEG electrode
locations are given in this coordinate system. In addition, the head
digitization data acquired in the beginning of an MEG, MEG/EEG,
or EEG acquisition are expressed in head coordinates. For details,
see <a class="reference internal" href="#chdedfib"><em>MEG/EEG and MRI coordinate systems</em></a>.</div></blockquote>
<p><strong>Device coordinates</strong></p>
<blockquote>
<div>This is a coordinate system tied to the MEG device. The relationship
of the Device and Head coordinates is determined during an MEG measurement
by feeding current to three to five head-position
indicator (HPI) coils and by determining their locations with respect
to the MEG sensor array from the magnetic fields they generate.</div></blockquote>
<p><strong>Sensor coordinates</strong></p>
<blockquote>
<div>Each MEG sensor has a local coordinate system defining the orientation
and location of the sensor. With help of this coordinate system,
the numerical integration data needed for the computation of the
magnetic field can be expressed conveniently as discussed in <a class="reference internal" href="#bjeiaeie"><em>Coil geometry information</em></a>. The channel information data in the fif files
contain the information to specify the coordinate transformation
between the coordinates of each sensor and the MEG device coordinates.</div></blockquote>
<p>The coordinate systems related
to MRI data are:</p>
<p><strong>Surface RAS coordinates</strong></p>
<blockquote>
<div>The FreeSurfer surface data are expressed in this coordinate system. The
origin of this coordinate system is at the center of the conformed
FreeSurfer MRI volumes (usually 256 x 256 x 256 isotropic 1-mm3  voxels)
and the axes are oriented along the axes of this volume. The BEM
surface and the locations of the sources in the source space are
usually expressed in this coordinate system in the fif files. In
this manual, the <em>Surface RAS coordinates</em> are
usually referred to as <em>MRI coordinates</em> unless
there is need to specifically discuss the different MRI-related
coordinate systems.</div></blockquote>
<p><strong>RAS coordinates</strong></p>
<blockquote>
<div>This coordinate system has axes identical to the Surface RAS coordinates but the location of the origin
is different and defined by the original MRI data, i.e. ,
the origin is in a scanner-dependent location. There is hardly any
need to refer to this coordinate system explicitly in the analysis
with the MNE software. However, since the Talairach coordinates,
discussed below, are defined with respect to <em>RAS coordinates</em> rather
than the <em>Surface RAS coordinates</em>, the RAS coordinate
system is implicitly involved in the transformation between Surface RAS coordinates and the two <em>Talairach</em> coordinate
systems.</div></blockquote>
<p><strong>MNI Talairach coordinates</strong></p>
<blockquote>
<div>The definition of this coordinate system is discussed, e.g. ,
in  <a class="reference external" href="http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach">http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach</a>. This
transformation is determined during the FreeSurfer reconstruction
process.</div></blockquote>
<p><strong>FreeSurfer Talairach coordinates</strong></p>
<blockquote>
<div>The problem with the MNI Talairach coordinates is that the linear MNI
Talairach transform does matched the brains completely to the Talairach
brain. This is probably because the Talairach atlas brain is a rather
odd shape, and as a result, it is difficult to match a standard brain
to the atlas brain using an affine transform. As a result, the MNI
brains are slightly larger (in particular higher, deeper and longer)
than the Talairach brain. The differences are larger as you get
further from the middle of the brain, towards the outside. The FreeSurfer
Talairach coordinates mitigate this problem by additing a an additional
transformation, defined separately for negatice and positive MNI
Talairach <img class="math" src="../_images/math/84d7271dd9e78c1e05d6c3c6ecb60309ef7dfc73.png" alt="z"/> coordinates. These two
transformations, denoted by <img class="math" src="../_images/math/83b818dacd8416b4f7583e8da655cfb37efbe3d5.png" alt="T_-"/> and <img class="math" src="../_images/math/75924c7f6094d79374678bb1164446951fd80f62.png" alt="T_+"/> in <a class="reference internal" href="#chdffjij"><em>MEG/EEG and MRI coordinate systems</em></a>, are fixed as discussed in <a class="reference external" href="http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach">http://imaging.mrc-cbu.cam.ac.uk/imaging/MniTalairach</a>
(<em>Approach 2</em>).</div></blockquote>
<p>The different coordinate systems are related by coordinate
transformations depicted in <a class="reference internal" href="#chdffjij"><em>MEG/EEG and MRI coordinate systems</em></a>. The arrows and
coordinate transformation symbols (<img class="math" src="../_images/math/d9424729510343e6830d47e1a146990c7b7ed661.png" alt="T_x"/>)
indicate the transformations actually present in the FreeSurfer
files. Generally,</p>
<div class="math">
<p><img src="../_images/math/0c2c5be0dff56711f079780f89c244a3a1dbbdf8.png" alt="\begin{bmatrix}
x_2 \\
y_2 \\
z_2 \\
1
\end{bmatrix} = T_{12} \begin{bmatrix}
x_1 \\
y_1 \\
z_1 \\
1
\end{bmatrix} = \begin{bmatrix}
R_{11} &amp; R_{12} &amp; R_{13} &amp; x_0 \\
R_{13} &amp; R_{13} &amp; R_{13} &amp; y_0 \\
R_{13} &amp; R_{13} &amp; R_{13} &amp; z_0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
x_1 \\
y_1 \\
z_1 \\
1
\end{bmatrix}\ ,"/></p>
</div><p>where <img class="math" src="../_images/math/5722016c3b6b6a8a3bf93235d6b2c9627dc3c676.png" alt="x_k"/>,:math:<cite>y_k</cite>,and <img class="math" src="../_images/math/4abd4a0e54e08944543c49bc089e16b0649465b5.png" alt="z_k"/> are the location
coordinates in two coordinate systems, <img class="math" src="../_images/math/34c7da48631b0c26fdb5c6a212821b18ebe9d75f.png" alt="T_{12}"/> is
the coordinate transformation from coordinate system &#8220;1&#8221; to &#8220;2&#8221;,
<img class="math" src="../_images/math/c3c08496f07567285212e468b173bea9ca153fab.png" alt="x_0"/>, <img class="math" src="../_images/math/f7e73389b494d356293b5ad9e3601a3a61609e96.png" alt="y_0"/>,and <img class="math" src="../_images/math/693faad2f042b0565c90df7cfced16cb9413c166.png" alt="z_0"/> is the location of the origin
of coordinate system &#8220;1&#8221; in coordinate system &#8220;2&#8221;,
and <img class="math" src="../_images/math/573468b8c8b9d5c86b4cc306993e80a837babf52.png" alt="R_{jk}"/> are the elements of the rotation
matrix relating the two coordinate systems. The coordinate transformations
are present in different files produced by FreeSurfer and MNE as
summarized in <a class="reference internal" href="#chdjdedj"><em>Coordinate transformations in FreeSurfer and MNE software packages. The symbols  are defined in CHDFFJIJ. Note: mne_make_cor_set /mne_setup_mri prior to release 2.6 did not include transformations , , , and  in the fif files produced.</em></a>. The fixed transformations <img class="math" src="../_images/math/83b818dacd8416b4f7583e8da655cfb37efbe3d5.png" alt="T_-"/> and <img class="math" src="../_images/math/75924c7f6094d79374678bb1164446951fd80f62.png" alt="T_+"/> are:</p>
<div class="math">
<p><img src="../_images/math/dc5c749b4c68bf38bd9c83d43aecfebba4695a55.png" alt="T_{-} = \begin{bmatrix}
0.99 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0.9688 &amp; 0.042 &amp; 0 \\
0 &amp; -0.0485 &amp; 0.839 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}"/></p>
</div><p>and</p>
<div class="math">
<p><img src="../_images/math/f48b9d0f41120c1e01ff4d66883add2626fe358f.png" alt="T_{+} = \begin{bmatrix}
0.99 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0.9688 &amp; 0.046 &amp; 0 \\
0 &amp; -0.0485 &amp; 0.9189 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}"/></p>
</div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section does not discuss the transformation    between the MRI voxel indices and the different MRI coordinates.    However, it is important to note that in FreeSurfer, MNE, as well    as in Neuromag software an integer voxel coordinate corresponds    to the location of the center of a voxel. Detailed information on    the FreeSurfer MRI systems can be found at  <a class="reference external" href="https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems">https://surfer.nmr.mgh.harvard.edu/fswiki/CoordinateSystems</a>.</p>
</div>
<table border="1" class="docutils" id="chdjdedj">
<caption>Coordinate transformations in FreeSurfer and MNE software packages. The symbols <img class="math" src="../_images/math/d9424729510343e6830d47e1a146990c7b7ed661.png" alt="T_x"/> are defined in <a class="reference internal" href="#chdffjij"><em>MEG/EEG and MRI coordinate systems</em></a>. Note: mne_make_cor_set /mne_setup_mri prior to release 2.6 did not include transformations <img class="math" src="../_images/math/b9994c8683876e2b06655e388d82f02147da76fa.png" alt="T_3"/>, <img class="math" src="../_images/math/342fe728eb5cbbac553873b4bc3b1b70f796d6aa.png" alt="T_4"/>, <img class="math" src="../_images/math/83b818dacd8416b4f7583e8da655cfb37efbe3d5.png" alt="T_-"/>, and <img class="math" src="../_images/math/75924c7f6094d79374678bb1164446951fd80f62.png" alt="T_+"/> in the fif files produced.</caption>
<colgroup>
<col width="30%" />
<col width="31%" />
<col width="38%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Transformation</td>
<td>FreeSurfer</td>
<td>MNE</td>
</tr>
<tr class="row-even"><td><img class="math" src="../_images/math/e4934a6da5a5a799606542faefa8cb95336bee82.png" alt="T_1"/></td>
<td>Not present</td>
<td><div class="first last line-block">
<div class="line">Measurement data files</div>
<div class="line">Forward solution files (<cite>*fwd.fif</cite>)</div>
<div class="line">Inverse operator files (<cite>*inv.fif</cite>)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><img class="math" src="../_images/math/8ded0189a67e6284d60c45b44da90b01f53009ee.png" alt="T_{s_1}\dots T_{s_n}"/></td>
<td>Not present</td>
<td>Channel information in files
containing <img class="math" src="../_images/math/e4934a6da5a5a799606542faefa8cb95336bee82.png" alt="T_1"/>.</td>
</tr>
<tr class="row-even"><td><img class="math" src="../_images/math/88e85b7f4f17a081d270a9f62304e6080881e439.png" alt="T_2"/></td>
<td>Not present</td>
<td><div class="first last line-block">
<div class="line">MRI description files Separate</div>
<div class="line">coordinate transformation files</div>
<div class="line">saved from mne_analyze</div>
<div class="line">Forward solution files</div>
<div class="line">Inverse operator files</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><img class="math" src="../_images/math/b9994c8683876e2b06655e388d82f02147da76fa.png" alt="T_3"/></td>
<td><cite>mri/*mgz</cite> files</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
<tr class="row-even"><td><img class="math" src="../_images/math/342fe728eb5cbbac553873b4bc3b1b70f796d6aa.png" alt="T_4"/></td>
<td>mri/transforms/talairach.xfm</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
<tr class="row-odd"><td><img class="math" src="../_images/math/83b818dacd8416b4f7583e8da655cfb37efbe3d5.png" alt="T_-"/></td>
<td>Hardcoded in software</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
<tr class="row-even"><td><img class="math" src="../_images/math/75924c7f6094d79374678bb1164446951fd80f62.png" alt="T_+"/></td>
<td>Hardcoded in software</td>
<td>MRI description files saved with
mne_make_cor_set if the input is in
mgz or mgh format.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-head-and-device-coordinate-systems">
<span id="bjebibai"></span><h2>The head and device coordinate systems<a class="headerlink" href="#the-head-and-device-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<div class="figure">
<img alt="Head coordinate system" src="../_images/HeadCS.png" />
<p class="caption">The head coordinate system</p>
</div>
<p>The MEG/EEG head coordinate system employed in the MNE software
is a right-handed Cartesian coordinate system. The direction of <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> axis
is from left to right, that of <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> axis
to the front, and the <img class="math" src="../_images/math/84d7271dd9e78c1e05d6c3c6ecb60309ef7dfc73.png" alt="z"/> axis thus
points up.</p>
<p>The <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> axis of the head coordinate
system passes through the two periauricular or preauricular points
digitized before acquiring the data with positive direction to the
right. The <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> axis passes through
the nasion and is normal to the <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> axis.
The <img class="math" src="../_images/math/84d7271dd9e78c1e05d6c3c6ecb60309ef7dfc73.png" alt="z"/> axis points up according to
the right-hand rule and is normal to the <img class="math" src="../_images/math/ba433fb15d4a342407ac3a29f01c1fbef83bd6e4.png" alt="xy"/> plane.</p>
<p>The origin of the MEG device coordinate system is device
dependent. Its origin is located approximately at the center of
a sphere which fits the occipital section of the MEG helmet best
with <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> axis axis going from left to right
and <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> axis pointing front. The <img class="math" src="../_images/math/84d7271dd9e78c1e05d6c3c6ecb60309ef7dfc73.png" alt="z"/> axis
is, again, normal to the <img class="math" src="../_images/math/ba433fb15d4a342407ac3a29f01c1fbef83bd6e4.png" alt="xy"/> plane
with positive direction up.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above definition is identical to that    of the Neuromag MEG/EEG (head) coordinate system. However, in 4-D    Neuroimaging and CTF MEG systems the head coordinate frame definition    is different. The origin of the coordinate system is at the midpoint    of the left and right auricular points. The <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> axis    passes through the nasion and the origin with positive direction    to the front. The <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> axis is perpendicular    to the <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> axis on the and lies in    the plane defined by the three fiducial landmarks, positive direction    from right to left. The <img class="math" src="../_images/math/84d7271dd9e78c1e05d6c3c6ecb60309ef7dfc73.png" alt="z"/> axis is    normal to the plane of the landmarks, pointing up. Note that in    this convention the auricular points are not necessarily located    on <img class="math" src="../_images/math/b124ff74afb0914bb434e8fb849eb56d734412f8.png" alt="y"/> coordinate axis. The file conversion utilities (see <a class="reference internal" href="convert.html#behiaadg"><em>Importing data from other MEG/EEG systems</em></a>)    take care of these idiosyncrasies and convert all coordinate information    to the MNE software head coordinate frame.</p>
</div>
</div>
<div class="section" id="creating-a-surface-based-source-space">
<span id="behcgjdd"></span><h2>Creating a surface-based source space<a class="headerlink" href="#creating-a-surface-based-source-space" title="Permalink to this headline">¶</a></h2>
<p>The fif format source space files containing the dipole locations
and orientations are created with the utility mne_make_source_space .
This utility is usually invoked by the convenience script mne_setup_source_space ,
see <a class="reference internal" href="cookbook.html#cihchdae"><em>Setting up the source space</em></a>.</p>
<p>The command-line options are:</p>
<p><strong>&#8212;version</strong></p>
<blockquote>
<div>Show the program version and compilation date.</div></blockquote>
<p><strong>&#8212;help</strong></p>
<blockquote>
<div>List the command-line options.</div></blockquote>
<p><strong>&#8212;subject &lt;*name*&gt;</strong></p>
<blockquote>
<div>Name of the subject in SUBJECTS_DIR. In the absence of this option,
the SUBJECT environment variable will be consulted. If it is not
defined, mne_setup_source_space exits
with an error.</div></blockquote>
<p><strong>&#8212;morph &lt;*name*&gt;</strong></p>
<blockquote>
<div>Name of a subject in SUBJECTS_DIR. If this option is present, the source
space will be first constructed for the subject defined by the &#8211;subject
option or the SUBJECT environment variable and then morphed to this
subject. This option is useful if you want to create a source spaces
for several subjects and want to directly compare the data across
subjects at the source space vertices without any morphing procedure
afterwards. The drawback of this approach is that the spacing between
source locations in the &#8220;morph&#8221; subject is not going
to be as uniform as it would be without morphing.</div></blockquote>
<p><strong>&#8212;surf &lt;*name1*&gt;: &lt;*name2*&gt;:...</strong></p>
<blockquote>
<div>FreeSurfer surface file names specifying the source surfaces, separated
by colons.</div></blockquote>
<p><strong>&#8212;spacing &lt;*spacing/mm*&gt;</strong></p>
<blockquote>
<div>Specifies the approximate grid spacing of the source space in mm.</div></blockquote>
<p><strong>&#8212;ico &lt;*number*&gt;</strong></p>
<blockquote>
<div>Instead of using the traditional method for cortical surface decimation
it is possible to create the source space using the topology of
a recursively subdivided icosahedron ( &lt;<em>number</em>&gt; &gt; 0)
or an octahedron ( &lt;<em>number</em>&gt;  &lt; 0).
This method uses the cortical surface inflated to a sphere as a
tool to find the appropriate vertices for the source space. The
benefit of the <tt class="docutils literal"><span class="pre">--ico</span></tt> option is that the source space will have triangulation
information between the decimated vertices included, which some
future versions of MNE software may be able to utilize. The number
of triangles increases by a factor of four in each subdivision,
starting from 20 triangles in an icosahedron and 8 triangles in
an octahedron. Since the number of vertices on a closed surface
is <img class="math" src="../_images/math/1ae22a3a3878f1d7fa0c36ffdf93ad9acb778caf.png" alt="n_{vert} = (n_{tri} + 4) / 2"/>, the number of vertices in
the <em>k</em> th subdivision of an icosahedron and an
octahedron are <img class="math" src="../_images/math/cc1fff4960f2919f44f3b179c392c99dbea87343.png" alt="10 \cdot 4^k +2"/> and <img class="math" src="../_images/math/7bc9230a762bf1f03bcaa719c13e118a71075b15.png" alt="4_{k + 1} + 2"/>,
respectively. The recommended values for &lt;<em>number</em>&gt; and
the corresponding number of source space locations are listed in Table 3.1.</div></blockquote>
<p><strong>&#8212;all</strong></p>
<blockquote>
<div>Include all nodes to the output. The active dipole nodes are identified
in the fif file by a separate tag. If tri files were used as input
the output file will also contain information about the surface
triangulation. This option is always recommended to include complete
information.</div></blockquote>
<p><strong>&#8212;src &lt;*name*&gt;</strong></p>
<blockquote>
<div>Output file name. Use a name &lt;<em>dir</em>&gt;/&lt;<em>name</em>&gt;-src.fif</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If both <tt class="docutils literal"><span class="pre">--ico</span></tt> and <tt class="docutils literal"><span class="pre">--spacing</span></tt> options    are present the later one on the command line takes precedence.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to the differences between the FreeSurfer    and MNE libraries, the number of source space points generated with    the <tt class="docutils literal"><span class="pre">--spacing</span></tt> option may be different between the current    version of MNE and versions 2.5 or earlier (using <tt class="docutils literal"><span class="pre">--spacing</span></tt> option    to mne_setup_source_space ) if    the FreeSurfer surfaces employ the (old) quadrangle format or if    there are topological defects on the surfaces. All new FreeSurfer    surfaces are specified as triangular tessellations and are e of    defects.</p>
</div>
</div>
<div class="section" id="creating-a-volumetric-or-discrete-source-space">
<span id="bjefehji"></span><h2>Creating a volumetric or discrete source space<a class="headerlink" href="#creating-a-volumetric-or-discrete-source-space" title="Permalink to this headline">¶</a></h2>
<p>In addition to source spaces confined to a surface, the MNE
software provides some support for three-dimensional source spaces
bounded by a surface as well as source spaces comprised of discrete,
arbitrarily located source points. The mne_volume_source_space utility
assists in generating such source spaces.</p>
<p>The command-line options are:</p>
<p><strong>&#8212;version</strong></p>
<blockquote>
<div>Show the program version and compilation date.</div></blockquote>
<p><strong>&#8212;help</strong></p>
<blockquote>
<div>List the command-line options.</div></blockquote>
<p><strong>&#8212;surf &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies a FreeSurfer surface file containing the surface which
will be used as the boundary for the source space.</div></blockquote>
<p><strong>&#8212;bem &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies a BEM file (ending in <tt class="docutils literal"><span class="pre">-bem.fif</span></tt> ). The inner
skull surface will be used as the boundary for the source space.</div></blockquote>
<p><strong>&#8212;origin &lt;*x/mm*&gt; : &lt;*y/mm*&gt; : &lt;*z/mm*&gt;</strong></p>
<blockquote>
<div>If neither of the two surface options described above is present,
the source space will be spherical with the origin at this location,
given in MRI (RAS) coordinates.</div></blockquote>
<p><strong>&#8212;rad &lt;*radius/mm*&gt;</strong></p>
<blockquote>
<div>Specifies the radius of a spherical source space. Default value
= 90 mm</div></blockquote>
<p><strong>&#8212;grid &lt;*spacing/mm*&gt;</strong></p>
<blockquote>
<div>Specifies the grid spacing in the source space.</div></blockquote>
<p><strong>&#8212;mindist &lt;*distance/mm*&gt;</strong></p>
<blockquote>
<div>Only points which are further than this distance from the bounding surface
are included. Default value = 5 mm.</div></blockquote>
<p><strong>&#8212;exclude &lt;*distance/mm*&gt;</strong></p>
<blockquote>
<div>Exclude points that are closer than this distance to the center
of mass of the bounding surface. By default, there will be no exclusion.</div></blockquote>
<p><strong>&#8212;mri &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies a MRI volume (in mgz or mgh format).
If this argument is present the output source space file will contain
a (sparse) interpolation matrix which allows mne_volume_data2mri to
create an MRI overlay file, see <a class="reference internal" href="convert.html#behdejec"><em>Converting volumetric data into an MRI overlay</em></a>.</div></blockquote>
<p><strong>&#8212;pos &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies a name of a text file containing the source locations
and, optionally, orientations. Each line of the file should contain
3 or 6 values. If the number of values is 3, they indicate the source
location, in millimeters. The orientation of the sources will be
set to the z-direction. If the number of values is 6, the source
orientation will be parallel to the vector defined by the remaining
3 numbers on each line. With <tt class="docutils literal"><span class="pre">--pos</span></tt> , all of the options
defined above will be ignored. By default, the source position and
orientation data are assumed to be given in MRI coordinates.</div></blockquote>
<p><strong>&#8212;head</strong></p>
<blockquote>
<div>If this option is present, the source locations and orientations
in the file specified with the <tt class="docutils literal"><span class="pre">--pos</span></tt> option are assumed
to be given in the MEG head coordinates.</div></blockquote>
<p><strong>&#8212;meters</strong></p>
<blockquote>
<div>Indicates that the source locations in the file defined with the <tt class="docutils literal"><span class="pre">--pos</span></tt> option
are give in meters instead of millimeters.</div></blockquote>
<p><strong>&#8212;src &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies the output file name. Use a name * &lt;<em>dir</em>&gt;/ &lt;<em>name</em>&gt;*-src.fif</div></blockquote>
<p><strong>&#8212;all</strong></p>
<blockquote>
<div>Include all vertices in the output file, not just those in use.
This option is implied when the <tt class="docutils literal"><span class="pre">--mri</span></tt> option is present.
Even with the <tt class="docutils literal"><span class="pre">--all</span></tt> option, only those vertices actually
selected will be marked to be &#8220;in use&#8221; in the
output source space file.</div></blockquote>
</div>
<div class="section" id="creating-the-bem-meshes">
<span id="behcaccj"></span><h2>Creating the BEM meshes<a class="headerlink" href="#creating-the-bem-meshes" title="Permalink to this headline">¶</a></h2>
<p>The mne_surf2bem utility
converts surface triangle meshes from ASCII and FreeSurfer binary
file formats to the fif format. The resulting fiff file also contains
conductivity information so that it can be employed in the BEM calculations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The utility mne_tri2fiff previously    used for this task has been replaced by mne_surf2bem .</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The convenience script mne_setup_forward_model described in <a class="reference internal" href="cookbook.html#cihdbfeg"><em>Setting up the boundary-element model</em></a> calls mne_surf2bem with    the appropriate options.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The vertices of all surfaces should be given    in the MRI coordinate system.</p>
</div>
<div class="section" id="command-line-options">
<h3>Command-line options<a class="headerlink" href="#command-line-options" title="Permalink to this headline">¶</a></h3>
<p>This program has the following
command-line options:</p>
<p><strong>&#8212;version</strong></p>
<blockquote>
<div>Show the program version and compilation date.</div></blockquote>
<p><strong>&#8212;help</strong></p>
<blockquote>
<div>List the command-line options.</div></blockquote>
<p><strong>&#8212;surf &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies a FreeSurfer binary format surface file. Before specifying the
next surface (<tt class="docutils literal"><span class="pre">--surf</span></tt> or <tt class="docutils literal"><span class="pre">--tri</span></tt> options)
details of the surface specification can be given with the options
listed in <a class="reference internal" href="#behcdicc"><em>Surface options</em></a>.</div></blockquote>
<p><strong>&#8212;tri &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies a text format surface file. Before specifying the next
surface (<tt class="docutils literal"><span class="pre">--surf</span></tt> or <tt class="docutils literal"><span class="pre">--tri</span></tt> options) details
of the surface specification can be given with the options listed
in <a class="reference internal" href="#behcdicc"><em>Surface options</em></a>. The format of these files is described
in <a class="reference internal" href="#behdefcd"><em>Tessellation file format</em></a>.</div></blockquote>
<p><strong>&#8212;check</strong></p>
<blockquote>
<div>Check that the surfaces are complete and that they do not intersect. This
is a recommended option. For more information, see <a class="reference internal" href="#behcbdde"><em>Topology checks</em></a>.</div></blockquote>
<p><strong>&#8212;checkmore</strong></p>
<blockquote>
<div>In addition to the checks implied by the <tt class="docutils literal"><span class="pre">--check</span></tt> option,
check skull and skull thicknesses. For more information, see <a class="reference internal" href="#behcbdde"><em>Topology checks</em></a>.</div></blockquote>
<p><strong>&#8212;fif &lt;*name*&gt;</strong></p>
<blockquote>
<div>The output fif file containing the BEM. These files normally reside in
the bem subdirectory under the subject&#8217;s mri data. A name
ending with <tt class="docutils literal"><span class="pre">-bem.fif</span></tt> is recommended.</div></blockquote>
</div>
<div class="section" id="surface-options">
<span id="behcdicc"></span><h3>Surface options<a class="headerlink" href="#surface-options" title="Permalink to this headline">¶</a></h3>
<p>These options can be specified after each <tt class="docutils literal"><span class="pre">--surf</span></tt> or <tt class="docutils literal"><span class="pre">--tri</span></tt> option
to define details for the corresponding surface.</p>
<p><strong>&#8212;swap</strong></p>
<blockquote>
<div>Swap the ordering or the triangle vertices. The standard convention in
the MNE software is to have the vertices ordered so that the vector
cross product of the vectors from vertex 1 to 2 and 1 to 3 gives the
direction of the outward surface normal. Text format triangle files
produced by the some software packages have an opposite order. For
these files, the <tt class="docutils literal"><span class="pre">--swap</span></tt> . option is required. This option does
not have any effect on the interpretation of the FreeSurfer surface
files specified with the <tt class="docutils literal"><span class="pre">--surf</span></tt> option.</div></blockquote>
<p><strong>&#8212;sigma &lt;*value*&gt;</strong></p>
<blockquote>
<div>The conductivity of the compartment inside this surface in S/m.</div></blockquote>
<p><strong>&#8212;shift &lt;*value/mm*&gt;</strong></p>
<blockquote>
<div>Shift the vertices of this surface by this amount, given in mm,
in the outward direction, <em>i.e.</em>, in the positive
vertex normal direction.</div></blockquote>
<p><strong>&#8212;meters</strong></p>
<blockquote>
<div>The vertex coordinates of this surface are given in meters instead
of millimeters. This option applies to text format files only. This
definition does not affect the units of the shift option.</div></blockquote>
<p><strong>&#8212;id &lt;*number*&gt;</strong></p>
<blockquote>
<div>Identification number to assign to this surface. (1 = inner skull, 3
= outer skull, 4 = scalp).</div></blockquote>
<p><strong>&#8212;ico &lt;*number*&gt;</strong></p>
<blockquote>
<div>Downsample the surface to the designated subdivision of an icosahedron.
This option is relevant (and required) only if the triangulation
is isomorphic with a recursively subdivided icosahedron. For example,
the surfaces produced by with mri_watershed are
isomorphic with the 5th subdivision of a an icosahedron thus containing 20480
triangles. However, this number of triangles is too large for present
computers. Therefore, the triangulations have to be decimated. Specifying <tt class="docutils literal"><span class="pre">--ico</span> <span class="pre">4</span></tt> yields 5120 triangles per surface while <tt class="docutils literal"><span class="pre">--ico</span> <span class="pre">3</span></tt> results
in 1280 triangles. The recommended choice is <tt class="docutils literal"><span class="pre">--ico</span> <span class="pre">4</span></tt> .</div></blockquote>
</div>
<div class="section" id="tessellation-file-format">
<span id="behdefcd"></span><h3>Tessellation file format<a class="headerlink" href="#tessellation-file-format" title="Permalink to this headline">¶</a></h3>
<p>The format of the text format surface files is the following:</p>
<blockquote>
<div><div class="line-block">
<div class="line">&lt;<em>nvert</em>&gt;</div>
<div class="line">&lt;<em>vertex 1</em>&gt;</div>
<div class="line">&lt;<em>vertex 2</em>&gt;</div>
<div class="line">...</div>
<div class="line">&lt;<em>vertex nvert</em>&gt;</div>
<div class="line">&lt;<em>ntri</em>&gt;</div>
<div class="line">&lt;<em>triangle 1</em>&gt;</div>
<div class="line">&lt;<em>triangle 2</em>&gt;</div>
<div class="line">...</div>
<div class="line">&lt;<em>triangle ntri</em>&gt; ,</div>
</div>
</div></blockquote>
<p>where &lt;<em>nvert</em>&gt; and &lt;<em>ntri</em>&gt; are
the number of vertices and number of triangles in the tessellation,
respectively.</p>
<p>The format of a vertex entry is
one of the following:</p>
<p><strong>x y z</strong></p>
<blockquote>
<div>The x, y, and z coordinates of the vertex location are given in
mm.</div></blockquote>
<p><strong>number x y z</strong></p>
<blockquote>
<div>A running number and the x, y, and z coordinates are given. The running
number is not considered by mne_tri2fiff. The nodes must be thus
listed in the correct consecutive order.</div></blockquote>
<p><strong>x y z nx ny nz</strong></p>
<blockquote>
<div>The x, y, and z coordinates as well as the approximate vertex normal direction
cosines are given.</div></blockquote>
<p><strong>number x y z nx ny nz</strong></p>
<blockquote>
<div>A running number is given in addition to the vertex location and vertex
normal.</div></blockquote>
<p>Each triangle entry consists of the numbers of the vertices
belonging to a triangle. The vertex numbering starts from one. The
triangle list may also contain running numbers on each line describing
a triangle.</p>
</div>
<div class="section" id="topology-checks">
<span id="behcbdde"></span><h3>Topology checks<a class="headerlink" href="#topology-checks" title="Permalink to this headline">¶</a></h3>
<p>If the <tt class="docutils literal"><span class="pre">--check</span></tt> option is specified, the following
topology checks are performed:</p>
<ul class="simple">
<li>The completeness of each surface is
confirmed by calculating the total solid angle subtended by all
triangles from a point inside the triangulation. The result should
be very close to <img class="math" src="../_images/math/54524bf407a6ceaf237252b9e79654928096eff3.png" alt="4 \pi"/>. If the result
is <img class="math" src="../_images/math/df51408103b0511ce15316914647b40b05ace08e.png" alt="-4 \pi"/> instead, it is conceivable
that the ordering of the triangle vertices is incorrect and the
<tt class="docutils literal"><span class="pre">--swap</span></tt> option should be specified.</li>
<li>The correct ordering of the surfaces is verified by checking
that the surfaces are inside each other as expected. This is accomplished
by checking that the sum solid angles subtended by triangles of
a surface <img class="math" src="../_images/math/7cb2124825a04b3e6813c89ed3003980593d3f9f.png" alt="S_k"/> at all vertices of another
surface <img class="math" src="../_images/math/9adc6e505db8f45be3f0bbde5258c7b5ba4181a9.png" alt="S_p"/> which is supposed to be
inside it equals <img class="math" src="../_images/math/54524bf407a6ceaf237252b9e79654928096eff3.png" alt="4 \pi"/>. Naturally, this
check is applied only if the model has more than one surface. Since
the surface relations are transitive, it is enough to check that
the outer skull surface is inside the skin surface and that the
inner skull surface is inside the outer skull one.</li>
<li>The extent of each of the triangulated volumes is checked.
If the extent is smaller than 50mm, an error is reported. This
may indicate that the vertex coordinates have been specified in
meters instead of millimeters.</li>
</ul>
</div>
</div>
<div class="section" id="computing-the-bem-geometry-data">
<span id="chdjfheb"></span><h2>Computing the BEM geometry data<a class="headerlink" href="#computing-the-bem-geometry-data" title="Permalink to this headline">¶</a></h2>
<p>The utility mne_prepare_bem_model computes
the geometry information for BEM. This utility is usually invoked
by the convenience script mne_setup_forward_model ,
see <a class="reference internal" href="cookbook.html#cihdbfeg"><em>Setting up the boundary-element model</em></a>. The command-line options are:</p>
<p><strong>&#8212;bem &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specify the name of the file containing the triangulations of the BEM
surfaces and the conductivities of the compartments. The standard
ending for this file is <tt class="docutils literal"><span class="pre">-bem.fif</span></tt> and it is produced
either with the utility mne_surf2bem (<a class="reference internal" href="#behcaccj"><em>Creating the BEM meshes</em></a>) or the convenience script mne_setup_forward_model ,
see <a class="reference internal" href="cookbook.html#cihdbfeg"><em>Setting up the boundary-element model</em></a>.</div></blockquote>
<p><strong>&#8212;sol &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specify the name of the file containing the triangulation and conductivity
information together with the BEM geometry matrix computed by mne_prepare_bem_model .
The standard ending for this file is <tt class="docutils literal"><span class="pre">-bem-sol.fif</span></tt> .</div></blockquote>
<p><strong>&#8212;method &lt;*approximation method*&gt;</strong></p>
<blockquote>
<div>Select the BEM approach. If &lt;<em>approximation method</em>&gt; is <tt class="docutils literal"><span class="pre">constant</span></tt> ,
the BEM basis functions are constant functions on each triangle
and the collocation points are the midpoints of the triangles. With <tt class="docutils literal"><span class="pre">linear</span></tt> ,
the BEM basis functions are linear functions on each triangle and
the collocation points are the vertices of the triangulation. This
is the preferred method to use. The accuracy will be the same or
better than in the constant collocation approach with about half
the number of unknowns in the BEM equations.</div></blockquote>
</div>
<div class="section" id="coil-geometry-information">
<span id="bjeiaeie"></span><h2>Coil geometry information<a class="headerlink" href="#coil-geometry-information" title="Permalink to this headline">¶</a></h2>
<p>This Section explains the presentation of MEG detection coil
geometry information the approximations used for different detection
coils in MNE software. Two pieces of information are needed to characterize
the detectors:</p>
<ul class="simple">
<li>The location and orientation a local
coordinate system for each detector.</li>
<li>A unique identifier, which has an one-to-one correspondence
to the geometrical description of the coil.</li>
</ul>
<div class="section" id="the-sensor-coordinate-system">
<h3>The sensor coordinate system<a class="headerlink" href="#the-sensor-coordinate-system" title="Permalink to this headline">¶</a></h3>
<p>The sensor coordinate system is completely characterized
by the location of its origin and the direction cosines of three
orthogonal unit vectors pointing to the directions of the x, y,
and z axis. In fact, the unit vectors contain redundant information
because the orientation can be uniquely defined with three angles.
The measurement fif files list these data in MEG device coordinates.
Transformation to the MEG head coordinate frame can be easily accomplished
by applying the device-to-head coordinate transformation matrix
available in the data files provided that the head-position indicator
was used. Optionally, the MNE software forward calculation applies
another coordinate transformation to the head-coordinate data to
bring the coil locations and orientations to the MRI coordinate system.</p>
<p>If <img class="math" src="../_images/math/b0153babd6c8369f8469e7f7ed416c511e3a825a.png" alt="r_0"/> is a row vector for
the origin of the local sensor coordinate system and <img class="math" src="../_images/math/9fb04c6ac3b7963e0a7c6d2bbd923a18bc8984f4.png" alt="e_x"/>, <img class="math" src="../_images/math/6fbacd1d802bbf2df87044bd7e5604e38e14dd04.png" alt="e_y"/>, and <img class="math" src="../_images/math/1fc26e795f7fb20c31b8feae6eda482aa53af671.png" alt="e_z"/> are the row vectors for the
three orthogonal unit vectors, all given in device coordinates,
a location of a point <img class="math" src="../_images/math/793d1ae9b3344c86fa99503e81b108c8a1dc8791.png" alt="r_C"/> in sensor coordinates
is transformed to device coordinates (<img class="math" src="../_images/math/565e4ad5b4567991c06834e6161c78c082c40ad0.png" alt="r_D"/>)
by</p>
<div class="math">
<p><img src="../_images/math/76585610c98d34fca23a2a211b35c059ed8f0a57.png" alt="[r_D 1] = [r_C 1] T_{CD}\ ,"/></p>
</div><p>where</p>
<div class="math">
<p><img src="../_images/math/78480a1cd126c91076f8af64b79fbcb6f369833b.png" alt="T = \begin{bmatrix}
e_x &amp; 0 \\
e_y &amp; 0 \\
e_z &amp; 0 \\
r_{0D} &amp; 1
\end{bmatrix}\ ."/></p>
</div></div>
<div class="section" id="calculation-of-the-magnetic-field">
<h3>Calculation of the magnetic field<a class="headerlink" href="#calculation-of-the-magnetic-field" title="Permalink to this headline">¶</a></h3>
<p>The forward calculation in the MNE software computes the
signals detected by each MEG sensor for three orthogonal dipoles
at each source space location. This requires specification of the
conductor model, the location and orientation of the dipoles, and
the location and orientation of each MEG sensor as well as its coil
geometry.</p>
<p>The output of each SQUID sensor is a weighted sum of the
magnetic fluxes threading the loops comprising the detection coil.
Since the flux threading a coil loop is an integral of the magnetic
field component normal to the coil plane, the output of the k <sup>th</sup>
MEG channel, <img class="math" src="../_images/math/60f83b5a089da399e1341e8e9b28f52804e3f64e.png" alt="b_k"/> can be approximated by:</p>
<div class="math">
<p><img src="../_images/math/d1d59a07673d00827afd022b7c18cc2a81996f05.png" alt="b_k = \sum_{p = 1}^{N_k} {w_{kp} B(r_{kp}) \cdot n_{kp}}"/></p>
</div><p>where <img class="math" src="../_images/math/ccb2c5b55443a6afc75933821007751c5efd7d5a.png" alt="r_{kp}"/> are a set of <img class="math" src="../_images/math/584b9ca1c31f8ae4c493d1bcd088a87b27e7fa39.png" alt="N_k"/> integration
points covering the pickup coil loops of the sensor, <img class="math" src="../_images/math/44a73338846ef27a54e616ed02a3f0f70619d372.png" alt="B(r_{kp})"/> is
the magnetic field due to the current sources calculated at <img class="math" src="../_images/math/ccb2c5b55443a6afc75933821007751c5efd7d5a.png" alt="r_{kp}"/>, <img class="math" src="../_images/math/0a7a0ad81f4b98c11a51ed71be6fbd3a45fbdff8.png" alt="n_{kp}"/> are
the coil normal directions at these points, and <img class="math" src="../_images/math/c62b57ddef2f0d490c1f9cd6bf161f07acbef5e2.png" alt="w_{kp}"/> are
the weights associated to the integration points. This formula essentially
presents numerical integration of the magnetic field over the pickup
loops of sensor <img class="math" src="../_images/math/e9203da50e1059455123460d4e716c9c7f440cc3.png" alt="k"/>.</p>
<p>There are three accuracy levels for the numerical integration
expressed above. The <em>simple</em> accuracy means
the simplest description of the coil. This accuracy is not used
in the MNE forward calculations. The <em>normal</em> or <em>recommended</em> accuracy typically uses
two integration points for planar gradiometers, one in each half
of the pickup coil and four evenly distributed integration points
for magnetometers. This is the default accuracy used by MNE. If
the <tt class="docutils literal"><span class="pre">--accurate</span></tt> option is specified, the forward calculation typically employs
a total of eight integration points for planar gradiometers and
sixteen for magnetometers. Detailed information about the integration
points is given in the next section.</p>
</div>
<div class="section" id="implemented-coil-geometries">
<h3>Implemented coil geometries<a class="headerlink" href="#implemented-coil-geometries" title="Permalink to this headline">¶</a></h3>
<p>This section describes the coil geometries currently implemented
in Neuromag software. The coil types fall in two general categories:</p>
<ul class="simple">
<li>Axial gradiometers and planar gradiometers
and</li>
<li>Planar gradiometers.</li>
</ul>
<p>For axial sensors, the <em>z</em> axis of the
local coordinate system is parallel to the field component detected, <em>i.e.</em>,
normal to the coil plane.For circular coils, the orientation of
the <em>x</em> and <em>y</em> axes on the
plane normal to the z axis is irrelevant. In the square coils employed
in the Vectorview (TM) system the <em>x</em> axis
is chosen to be parallel to one of the sides of the magnetometer
coil. For planar sensors, the <em>z</em> axis is likewise
normal to the coil plane and the x axis passes through the centerpoints
of the two coil loops so that the detector gives a positive signal
when the normal field component increases along the <em>x</em> axis.</p>
<p><a class="reference internal" href="#bgbbhgec"><em>Normal coil descriptions. Note: If a plus-minus sign occurs in several coordinates, all possible combinations have to be included.</em></a> lists the parameters of the <em>normal</em> coil
geometry descriptions <a class="reference internal" href="#chdbdfje"><em>Accurate coil descriptions</em></a> lists the <em>accurate</em> descriptions. For simple accuracy,
please consult the coil definition file, see <a class="reference internal" href="#bjecigeb"><em>The coil definition file</em></a>.
The columns of the tables contain the following data:</p>
<ul class="simple">
<li>The number identifying the coil id.
This number is used in the coil descriptions found in the FIF files.</li>
<li>Description of the coil.</li>
<li>Number of integration points used</li>
<li>The locations of the integration points in sensor coordinates.</li>
<li>Weights assigned to the field values at the integration points.
Some formulas are listed instead of the numerical values to demonstrate
the principle of the calculation. For example, in the normal coil
descriptions of the planar gradiometers the weights are inverses
of the baseline of the gradiometer to show that the output is in
T/m.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The coil geometry information is stored in the file $MNE_ROOT/share/mne/coil_def.dat, which is automatically created by the utility mne_list_coil_def , see <a class="reference internal" href="#bjehhjij"><em>Creating the coil definition file</em></a>.</p>
</div>
<table border="1" class="docutils" id="bgbbhgec">
<caption>Normal coil descriptions. Note: If a plus-minus sign occurs in several coordinates, all possible combinations have to be included.</caption>
<colgroup>
<col width="7%" />
<col width="27%" />
<col width="4%" />
<col width="37%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Id</th>
<th class="head">Description</th>
<th class="head">n</th>
<th class="head">r/mm</th>
<th class="head">w</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2</td>
<td>Neuromag-122
planar gradiometer</td>
<td>2</td>
<td>(+/-8.1, 0, 0) mm</td>
<td>+/-1 ⁄ 16.2mm</td>
</tr>
<tr class="row-odd"><td>2000</td>
<td>A point magnetometer</td>
<td>1</td>
<td>(0, 0, 0)mm</td>
<td>1</td>
</tr>
<tr class="row-even"><td>3012</td>
<td>Vectorview type 1
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-odd"><td>3013</td>
<td>Vectorview type 2
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-even"><td>3022</td>
<td>Vectorview type 1
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>3023</td>
<td>Vectorview type 2
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-even"><td>3024</td>
<td>Vectorview type 3
magnetometer</td>
<td>4</td>
<td>(+/-5.25, +/-5.25, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>2000</td>
<td>An ideal point
magnetometer</td>
<td>1</td>
<td>(0.0, 0.0, 0.0)mm</td>
<td>1</td>
</tr>
<tr class="row-even"><td>4001</td>
<td>Magnes WH
magnetometer</td>
<td>4</td>
<td>(+/-5.75, +/-5.75, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>4002</td>
<td>Magnes WH 3600
axial gradiometer</td>
<td>8</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 50.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>4003</td>
<td>Magnes reference
magnetometer</td>
<td>4</td>
<td>(+/-7.5, +/-7.5, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>4004</td>
<td>Magnes reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-20, +/-20, 0.0)mm
(+/-20, +/-20, 135)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>4005</td>
<td>Magnes reference
gradiometer measuring
off-diagonal gradients</td>
<td>8</td>
<td>(87.5, +/-20, 0.0)mm
(47.5, +/-20, 0.0)mm
(-87.5, +/-20, 0.0)mm
(-47.5, +/-20, 0.0)mm</td>
<td>1/4
-1/4
1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>5001</td>
<td>CTF 275 axial
gradiometer</td>
<td>8</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 50.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>5002</td>
<td>CTF reference
magnetometer</td>
<td>4</td>
<td>(+/-4, +/-4, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>5003</td>
<td>CTF reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-8.6, +/-8.6, 0.0)mm
(+/-8.6, +/-8.6, 78.6)mm</td>
<td>1/4
-1/4</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="chdbdfje">
<caption>Accurate coil descriptions</caption>
<colgroup>
<col width="7%" />
<col width="27%" />
<col width="4%" />
<col width="37%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Id</th>
<th class="head">Description</th>
<th class="head">n</th>
<th class="head">r/mm</th>
<th class="head">w</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2</td>
<td>Neuromag-122 planar
gradiometer</td>
<td>8</td>
<td>+/-(8.1, 0, 0) mm</td>
<td>+/-1 ⁄ 16.2mm</td>
</tr>
<tr class="row-odd"><td>2000</td>
<td>A point magnetometer</td>
<td>1</td>
<td>(0, 0, 0) mm</td>
<td>1</td>
</tr>
<tr class="row-even"><td>3012</td>
<td>Vectorview type 1
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-odd"><td>3013</td>
<td>Vectorview type 2
planar gradiometer</td>
<td>2</td>
<td>(+/-8.4, 0, 0.3) mm</td>
<td>+/-1 ⁄ 16.8mm</td>
</tr>
<tr class="row-even"><td>3022</td>
<td>Vectorview type 1
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>3023</td>
<td>Vectorview type 2
magnetometer</td>
<td>4</td>
<td>(+/-6.45, +/-6.45, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-even"><td>3024</td>
<td>Vectorview type 3
magnetometer</td>
<td>4</td>
<td>(+/-5.25, +/-5.25, 0.3)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>4001</td>
<td>Magnes WH magnetometer</td>
<td>4</td>
<td>(+/-5.75, +/-5.75, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-even"><td>4002</td>
<td>Magnes WH 3600
axial gradiometer</td>
<td>4</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 0.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>4004</td>
<td>Magnes reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-20, +/-20, 0.0)mm
(+/-20, +/-20, 135)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>4005</td>
<td>Magnes reference
gradiometer measuring
off-diagonal gradients</td>
<td>8</td>
<td>(87.5, +/-20, 0.0)mm
(47.5, +/-20, 0.0)mm
(-87.5, +/-20, 0.0)mm
(-47.5, +/-20, 0.0)mm</td>
<td>1/4
-1/4
1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>5001</td>
<td>CTF 275 axial
gradiometer</td>
<td>8</td>
<td>(+/-4.5, +/-4.5, 0.0)mm
(+/-4.5, +/-4.5, 50.0)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>5002</td>
<td>CTF reference
magnetometer</td>
<td>4</td>
<td>(+/-4, +/-4, 0.0)mm</td>
<td>1/4</td>
</tr>
<tr class="row-odd"><td>5003</td>
<td>CTF 275 reference
gradiometer measuring
diagonal gradients</td>
<td>8</td>
<td>(+/-8.6, +/-8.6, 0.0)mm
(+/-8.6, +/-8.6, 78.6)mm</td>
<td>1/4
-1/4</td>
</tr>
<tr class="row-even"><td>5004</td>
<td>CTF 275 reference
gradiometer measuring
off-diagonal gradients</td>
<td>8</td>
<td>(47.8, +/-8.5, 0.0)mm
(30.8, +/-8.5, 0.0)mm
(-47.8, +/-8.5, 0.0)mm
(-30.8, +/-8.5, 0.0)mm</td>
<td>1/4
-1/4
1/4
-1/4</td>
</tr>
<tr class="row-odd"><td>6001</td>
<td>MIT KIT system axial
gradiometer</td>
<td>8</td>
<td>(+/-3.875, +/-3.875, 0.0)mm
(+/-3.875, +/-3.875, 0.0)mm</td>
<td>1/4
-1/4</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-coil-definition-file">
<span id="bjecigeb"></span><h3>The coil definition file<a class="headerlink" href="#the-coil-definition-file" title="Permalink to this headline">¶</a></h3>
<p>The coil geometry information is stored in the text file
$MNE_ROOT/share/mne/coil_def.dat. In this file, any lines starting
with the pound sign (#) are comments. A coil definition starts with
a description line containing the following fields:</p>
<p>** &lt;<em>class</em>&gt;**</p>
<blockquote>
<div>This is a number indicating class of this coil. Possible values
are listed in <a class="reference internal" href="#bjefabha"><em>Coil class values</em></a>.</div></blockquote>
<p>** &lt;<em>id</em>&gt;**</p>
<blockquote>
<div>Coil id value. This value is listed in the first column of Tables <a class="reference internal" href="#bgbbhgec"><em>Normal coil descriptions. Note: If a plus-minus sign occurs in several coordinates, all possible combinations have to be included.</em></a> and <a class="reference internal" href="#chdbdfje"><em>Accurate coil descriptions</em></a>.</div></blockquote>
<p>** &lt;<em>accuracy</em>&gt;**</p>
<blockquote>
<div>The coil representation accuracy. Possible values and their meanings
are listed in <a class="reference internal" href="#bjehibjc"><em>Coil representation accuracies.</em></a>.</div></blockquote>
<p>** &lt;<em>np</em>&gt;**</p>
<blockquote>
<div>Number of integration points in this representation.</div></blockquote>
<p>** &lt;<em>size/m</em>&gt;**</p>
<blockquote>
<div>The size of the coil. For circular coils this is the diameter of
the coil and for square ones the side length of the square. This
information is mainly included to facilitate drawing of the coil
geometry. It should not be employed to infer a coil approximation
for the forward calculations.</div></blockquote>
<p>** &lt;<em>baseline/m</em>&gt;**</p>
<blockquote>
<div>The baseline of a this kind of a coil. This will be zero for magnetometer
coils. This information is mainly included to facilitate drawing
of the coil geometry. It should not be employed to infer a coil
approximation for the forward calculations.</div></blockquote>
<p>** &lt;<em>description</em>&gt;**</p>
<blockquote>
<div>Short description of this kind of a coil. If the description contains several
words, it is enclosed in quotes.</div></blockquote>
<table border="1" class="docutils" id="bjefabha">
<caption>Coil class values</caption>
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>magnetometer</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>first-order axial gradiometer</td>
</tr>
<tr class="row-even"><td>3</td>
<td>planar gradiometer</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>second-order axial gradiometer</td>
</tr>
<tr class="row-even"><td>1000</td>
<td>an EEG electrode (used internally in software only).</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="bjehibjc">
<caption>Coil representation accuracies.</caption>
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>The simplest representation available</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>The standard or <em>normal</em> representation (see <a class="reference internal" href="#bgbbhgec"><em>Normal coil descriptions. Note: If a plus-minus sign occurs in several coordinates, all possible combinations have to be included.</em></a>)</td>
</tr>
<tr class="row-even"><td>3</td>
<td>The most <em>accurate</em> representation available (see <a class="reference internal" href="#chdbdfje"><em>Accurate coil descriptions</em></a>)</td>
</tr>
</tbody>
</table>
<p>Each coil description line is followed by one or more integration
point lines, consisting of seven numbers:</p>
<p>** &lt;<em>weight</em>&gt;**</p>
<blockquote>
<div>Gives the weight for this integration point (last column in Tables <a class="reference internal" href="#bgbbhgec"><em>Normal coil descriptions. Note: If a plus-minus sign occurs in several coordinates, all possible combinations have to be included.</em></a> and <a class="reference internal" href="#chdbdfje"><em>Accurate coil descriptions</em></a>).</div></blockquote>
<p>** &lt;<em>x/m</em>&gt; &lt;<em>y/m</em>&gt; &lt;<em>z/m</em>&gt;**</p>
<blockquote>
<div>Indicates the location of the integration point (fourth column in Tables <a class="reference internal" href="#bgbbhgec"><em>Normal coil descriptions. Note: If a plus-minus sign occurs in several coordinates, all possible combinations have to be included.</em></a> and <a class="reference internal" href="#chdbdfje"><em>Accurate coil descriptions</em></a>).</div></blockquote>
<p>** &lt;<em>nx</em>&gt; &lt;<em>ny</em>&gt; &lt;<em>nz</em>&gt;**</p>
<blockquote>
<div>Components of a unit vector indicating the field component to be selected.
Note that listing a separate unit vector for each integration points
allows the implementation of curved coils and coils with the gradiometer
loops tilted with respect to each other.</div></blockquote>
</div>
<div class="section" id="creating-the-coil-definition-file">
<span id="bjehhjij"></span><h3>Creating the coil definition file<a class="headerlink" href="#creating-the-coil-definition-file" title="Permalink to this headline">¶</a></h3>
<p>The standard coil definition file $MNE_ROOT/share/mne/coil_def.dat
is included with the MNE software package. The coil definition file
can be recreated with the utility mne_list_coil_def
as follows:</p>
<p>mne_list_coil_def &#8211;out $MNE_ROOT/share/mne/coil_def.dat</p>
</div>
</div>
<div class="section" id="computing-the-forward-solution">
<span id="chddibah"></span><h2>Computing the forward solution<a class="headerlink" href="#computing-the-forward-solution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="purpose">
<h3>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h3>
<p>Instead of using the convenience script mne_do_forward_solution it
is also possible to invoke the forward solution computation program mne_forward_solution directly.
In this approach, the convenience of the automatic file naming conventions
present in mne_do_forward_solution are
lost. However, there are some special-purpose options available
in mne_forward_solution only.
Please refer to <a class="reference internal" href="cookbook.html#babchejd"><em>Computing the forward solution</em></a> for information on mne_do_forward_solution.</p>
</div>
<div class="section" id="bjeigfae">
<span id="id1"></span><h3>Command line options<a class="headerlink" href="#bjeigfae" title="Permalink to this headline">¶</a></h3>
<p>mne_forward_solution accepts
the following command-line options:</p>
<p><strong>&#8212;src &lt;*name*&gt;</strong></p>
<blockquote>
<div>Source space name to use. The name of the file must be specified exactly,
including the directory. Typically, the source space files reside
in $SUBJECTS_DIR/$SUBJECT/bem.</div></blockquote>
<p><strong>&#8212;bem &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies the BEM to be used. These files end with bem.fif or bem-sol.fif and
reside in $SUBJECTS_DIR/$SUBJECT/bem. The former file contains only
the BEM surface information while the latter files contain the geometry
information precomputed with mne_prepare_bem_model ,
see <a class="reference internal" href="#chdjfheb"><em>Computing the BEM geometry data</em></a>. If precomputed geometry is not available,
the linear collocation solution will be computed by mne_forward_solution .</div></blockquote>
<p><strong>&#8212;origin &lt;*x/mm*&gt; : &lt;*x/mm*&gt; : &lt;*z/mm*&gt;</strong></p>
<blockquote>
<div>Indicates that the sphere model should be used in the forward calculations.
The origin is specified in MEG head coordinates unless the <tt class="docutils literal"><span class="pre">--mricoord</span></tt> option
is present. The MEG sphere model solution computed using the analytical
Sarvas formula. For EEG, an approximative solution described in</div></blockquote>
<p><strong>&#8212;eegmodels &lt;*name*&gt;</strong></p>
<blockquote>
<div>This option is significant only if the sphere model is used and
EEG channels are present. The specified file contains specifications
of the EEG sphere model layer structures as detailed in <a class="reference internal" href="#chdiafig"><em>The EEG sphere model definition file</em></a>. If this option is absent the file <tt class="docutils literal"><span class="pre">$HOME/.mne/EEG_models</span></tt> will
be consulted if it exists.</div></blockquote>
<p><strong>&#8212;eegmodel &lt;*model name*&gt;</strong></p>
<blockquote>
<div>Specifies the name of the sphere model to be used for EEG. If this option
is missing, the model Default will
be employed, see <a class="reference internal" href="#chdiafig"><em>The EEG sphere model definition file</em></a>.</div></blockquote>
<p><strong>&#8212;eegrad &lt;*radius/mm*&gt;</strong></p>
<blockquote>
<div>Specifies the radius of the outermost surface (scalp) of the EEG sphere
model, see <a class="reference internal" href="#chdiafig"><em>The EEG sphere model definition file</em></a>. The default value is 90 mm.</div></blockquote>
<p><strong>&#8212;eegscalp</strong></p>
<blockquote>
<div>Scale the EEG electrode locations to the surface of the outermost sphere
when using the sphere model.</div></blockquote>
<p><strong>&#8212;accurate</strong></p>
<blockquote>
<div>Use accurate MEG sensor coil descriptions. This is the recommended
choice. More information</div></blockquote>
<p><strong>&#8212;fixed</strong></p>
<blockquote>
<div>Compute the solution for sources normal to the cortical mantle only. This
option should be used only for surface-based and discrete source
spaces.</div></blockquote>
<p><strong>&#8212;all</strong></p>
<blockquote>
<div>Compute the forward solution for all vertices on the source space.</div></blockquote>
<p><strong>&#8212;label &lt;*name*&gt;</strong></p>
<blockquote>
<div>Compute the solution only for points within the specified label. Multiple
labels can be present. The label files should end with <tt class="docutils literal"><span class="pre">-lh.label</span></tt> or <tt class="docutils literal"><span class="pre">-rh.label</span></tt> for
left and right hemisphere label files, respectively. If <tt class="docutils literal"><span class="pre">--all</span></tt> flag
is present, all surface points falling within the labels are included.
Otherwise, only decimated points with in the label are selected.</div></blockquote>
<p><strong>&#8212;mindist &lt;*dist/mm*&gt;</strong></p>
<blockquote>
<div>Omit source space points closer than this value to the inner skull surface.
Any source space points outside the inner skull surface are automatically
omitted. The use of this option ensures that numerical inaccuracies
for very superficial sources do not cause unexpected effects in
the final current estimates. Suitable value for this parameter is
of the order of the size of the triangles on the inner skull surface.
If you employ the seglab software to create the triangulations, this
value should be about equal to the wish for the side length of the
triangles.</div></blockquote>
<p><strong>&#8212;mindistout &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies a file name to contain the coordinates of source space points
omitted due to the <tt class="docutils literal"><span class="pre">--mindist</span></tt> option.</div></blockquote>
<p><strong>&#8212;mri &lt;*name*&gt;</strong></p>
<blockquote>
<div>The name of the MRI description file containing the MEG/MRI coordinate
transformation. This file was saved as part of the alignment procedure
outlined in <a class="reference internal" href="cookbook.html#chdbehdc"><em>Aligning the coordinate frames</em></a>. These files typically reside in <tt class="docutils literal"><span class="pre">$SUBJECTS_DIR/$SUBJECT/mri/T1-neuromag/sets</span></tt> .</div></blockquote>
<p><strong>&#8212;trans      &lt;*name*&gt;</strong></p>
<blockquote>
<div>The name of a text file containing the 4 x 4 matrix for the coordinate transformation
from head to mri coordinates. With <tt class="docutils literal"><span class="pre">--trans</span></tt>, <tt class="docutils literal"><span class="pre">--mri</span></tt> option is not
required.</div></blockquote>
<p><strong>&#8212;notrans</strong></p>
<blockquote>
<div>The MEG/MRI coordinate transformation is taken as the identity transformation, <em>i.e.</em>,
the two coordinate systems are the same. This option is useful only
in special circumstances. If more than one of the <tt class="docutils literal"><span class="pre">--mri</span></tt> , <tt class="docutils literal"><span class="pre">--trans</span></tt> ,
and <tt class="docutils literal"><span class="pre">--notrans</span></tt> options are specified, the last one remains
in effect.</div></blockquote>
<p><strong>&#8212;mricoord</strong></p>
<blockquote>
<div>Do all computations in the MRI coordinate system. The forward solution
matrix is not affected by this option if the source orientations
are fixed to be normal to the cortical mantle. If all three source components
are included, the forward three source orientations parallel to
the coordinate axes is computed. If <tt class="docutils literal"><span class="pre">--mricoord</span></tt> is present, these
axes correspond to MRI coordinate system rather than the default
MEG head coordinate system. This option is useful only in special
circumstances.</div></blockquote>
<p><strong>&#8212;meas &lt;*name*&gt;</strong></p>
<blockquote>
<div>This file is the measurement fif file or an off-line average file
produced thereof. It is recommended that the average file is employed for
evoked-response data and the original raw data file otherwise. This
file provides the MEG sensor locations and orientations as well as
EEG electrode locations as well as the coordinate transformation between
the MEG device coordinates and MEG head-based coordinates.</div></blockquote>
<p><strong>&#8212;fwd &lt;*name*&gt;</strong></p>
<blockquote>
<div>This file will contain the forward solution as well as the coordinate transformations,
sensor and electrode location information, and the source space
data. A name of the form &lt;<em>name</em>&gt;-fwd.fif is
recommended.</div></blockquote>
<p><strong>&#8212;meg</strong></p>
<blockquote>
<div>Compute the MEG forward solution.</div></blockquote>
<p><strong>&#8212;eeg</strong></p>
<blockquote>
<div>Compute the EEG forward solution.</div></blockquote>
<p><strong>&#8212;grad</strong></p>
<blockquote>
<div>Include the derivatives of the fields with respect to the dipole
position coordinates to the output, see <a class="reference internal" href="#bjefejjg"><em>Field derivatives</em></a>.</div></blockquote>
</div>
<div class="section" id="implementation-of-software-gradient-compensation">
<h3>Implementation of software gradient compensation<a class="headerlink" href="#implementation-of-software-gradient-compensation" title="Permalink to this headline">¶</a></h3>
<p>As described in <a class="reference internal" href="convert.html#behddfbi"><em>Applying software gradient compensation</em></a> the CTF and 4D Neuroimaging
data may have been subjected to noise cancellation employing the
data from the reference sensor array. Even though these sensor are
rather far away from the brain sources, mne_forward_solution takes
them into account in the computations. If the data file specified
with the <tt class="docutils literal"><span class="pre">--meas</span></tt> option has software gradient compensation
activated, mne_forward_solution computes
the field of at the reference sensors in addition to the main MEG
sensor array and computes a compensated forward solution using the
methods described in <a class="reference internal" href="convert.html#behddfbi"><em>Applying software gradient compensation</em></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If a data file specified with the <tt class="docutils literal"><span class="pre">--meas</span></tt> option    and that used in the actual inverse computations with mne_analyze and mne_make_movie have    different software gradient compensation states., the forward solution    will be in mismatch with the data to be analyzed and the current    estimates will be slightly erroneous.</p>
</div>
</div>
<div class="section" id="the-eeg-sphere-model-definition-file">
<span id="chdiafig"></span><h3>The EEG sphere model definition file<a class="headerlink" href="#the-eeg-sphere-model-definition-file" title="Permalink to this headline">¶</a></h3>
<p>For the computation of the electric potential distribution
on the surface of the head (EEG) it is necessary to define the conductivities
(<img class="math" src="../_images/math/2298cf1485084afe72757a9c8483af49a138d81f.png" alt="\sigma"/>) and radiuses of the spherically
symmetric layers. Different sphere models can be specified with
the <tt class="docutils literal"><span class="pre">--eegmodels</span></tt> option.</p>
<p>The EEG sphere model definition files may contain comment
lines starting with a # and model
definition lines in the following format:</p>
<blockquote>
<div>&lt;<em>name</em>&gt;: &lt;<em>radius1</em>&gt;: &lt;<em>conductivity1</em>&gt;: &lt;<em>radius2</em>&gt;: &lt;<em>conductivity2</em>&gt;:...</div></blockquote>
<p>When the file is loaded the layers are sorted so that the
radiuses will be in ascending order and the radius of the outermost
layer is scaled to 1.0. The scalp radius specified with the <tt class="docutils literal"><span class="pre">--eegrad</span></tt> option
is then consulted to scale the model to the correct dimensions.
Even if the model setup file is not present, a model called Default is
always provided. This model has the structure given in <a class="reference internal" href="#babebgda"><em>Structure of the default EEG model</em></a></p>
<table border="1" class="docutils" id="babebgda">
<caption>Structure of the default EEG model</caption>
<colgroup>
<col width="15%" />
<col width="43%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Layer</th>
<th class="head">Relative outer radius</th>
<th class="head"><img class="math" src="../_images/math/2298cf1485084afe72757a9c8483af49a138d81f.png" alt="\sigma"/> (S/m)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Head</td>
<td>1.0</td>
<td>0.33</td>
</tr>
<tr class="row-odd"><td>Skull</td>
<td>0.97</td>
<td>0.04</td>
</tr>
<tr class="row-even"><td>CSF</td>
<td>0.92</td>
<td>1.0</td>
</tr>
<tr class="row-odd"><td>Brain</td>
<td>0.90</td>
<td>0.33</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="eeg-forward-solution-in-the-sphere-model">
<h3>EEG forward solution in the sphere model<a class="headerlink" href="#eeg-forward-solution-in-the-sphere-model" title="Permalink to this headline">¶</a></h3>
<p>When the sphere model is employed, the computation of the
EEG solution can be substantially accelerated by using approximation
methods described by Mosher, Zhang, and Berg, see <a class="reference internal" href="reading.html#cegegdei"><em>Forward modeling</em></a> (Mosher <em>et
al.</em> and references therein). mne_forward_solution approximates
the solution with three dipoles in a homogeneous sphere whose locations
and amplitudes are determined by minimizing the cost function:</p>
<div class="math">
<p><img src="../_images/math/129d70f6b026af0381f4ab20ac0a529464020696.png" alt="S(r_1,\dotsc,r_m\ ,\ \mu_1,\dotsc,\mu_m) = \int_{scalp} {(V_{true} - V_{approx})}\,dS"/></p>
</div><p>where <img class="math" src="../_images/math/a095b4eea299f755e93c6e242572ee463e20ce2b.png" alt="r_1,\dotsc,r_m"/> and <img class="math" src="../_images/math/d6f75e735c2e90ddc84429814fd724a94316b033.png" alt="\mu_1,\dotsc,\mu_m"/> are
the locations and amplitudes of the approximating dipoles and <img class="math" src="../_images/math/065ed0019e8946fabcbb394b36726bf235c2a562.png" alt="V_{true}"/> and <img class="math" src="../_images/math/4d9d05e9daf5a276ce1b3bc31fab8945cc6c73ea.png" alt="V_{approx}"/> are
the potential distributions given by the true and approximative
formulas, respectively. It can be shown that this integral can be
expressed in closed form using an expansion of the potentials in
spherical harmonics. The formula is evaluated for the most superficial
dipoles, <em>i.e.</em>, those lying just inside the
inner skull surface.</p>
</div>
<div class="section" id="field-derivatives">
<span id="bjefejjg"></span><h3>Field derivatives<a class="headerlink" href="#field-derivatives" title="Permalink to this headline">¶</a></h3>
<p>If the <tt class="docutils literal"><span class="pre">--grad</span></tt> option is specified, mne_forward_solution includes
the derivatives of the forward solution with respect to the dipole
location coordinates to the output file. Let</p>
<div class="math">
<p><img src="../_images/math/9c6a6b6e0d4af95bbaa9288eab78dc2bb1668e2d.png" alt="G_k = [g_{xk} g_{yk} g_{zk}]"/></p>
</div><p>be the <img class="math" src="../_images/math/5eac39792bb62a236256aafa4fc085dc86c7dc5a.png" alt="N_{chan} \times 3"/> matrix containing
the signals produced by three orthogonal dipoles at location <img class="math" src="../_images/math/c6d83f44e641552ebc20f736bbca0a9423098e78.png" alt="r_k"/> making
up <img class="math" src="../_images/math/8b26fae51911c96e440ea6b547fd8a20e1782059.png" alt="N_{chan} \times 3N_{source}"/> the gain matrix</p>
<div class="math">
<p><img src="../_images/math/1d7e67c9001fee615a88a64a72fd088b8e844de9.png" alt="G = [G_1 \dotso G_{N_{source}}]\ ."/></p>
</div><p>With the <tt class="docutils literal"><span class="pre">--grad</span></tt> option, the output from mne_forward_solution also
contains the <img class="math" src="../_images/math/ebe8fd15ce22af21a48cb9643373544e501b04a3.png" alt="N_{chan} \times 9N_{source}"/> derivative matrix</p>
<div class="math">
<p><img src="../_images/math/59ca7383799a4e1b3a0ea97abf81f8d5c98cf9fd.png" alt="D = [D_1 \dotso D_{N_{source}}]\ ,"/></p>
</div><p>where</p>
<div class="math">
<p><img src="../_images/math/25b7a4e7065ed8af9d576d2554dd07c2e2c4caa0.png" alt="D_k = [\frac{\delta g_{xk}}{\delta x_k} \frac{\delta g_{xk}}{\delta y_k} \frac{\delta g_{xk}}{\delta z_k} \frac{\delta g_{yk}}{\delta x_k} \frac{\delta g_{yk}}{\delta y_k} \frac{\delta g_{yk}}{\delta z_k} \frac{\delta g_{zk}}{\delta x_k} \frac{\delta g_{zk}}{\delta y_k} \frac{\delta g_{zk}}{\delta z_k}]\ ,"/></p>
</div><p>where <img class="math" src="../_images/math/5722016c3b6b6a8a3bf93235d6b2c9627dc3c676.png" alt="x_k"/>, <img class="math" src="../_images/math/4520081052dd155a003892ac4f689f04bdbbcb3c.png" alt="y_k"/>, and <img class="math" src="../_images/math/4abd4a0e54e08944543c49bc089e16b0649465b5.png" alt="z_k"/> are the location
coordinates of the <img class="math" src="../_images/math/95cd8c0e712982ebb308efa59408cf9962067b3c.png" alt="k^{th}"/> dipole. If
the dipole orientations are to the cortical normal with the <tt class="docutils literal"><span class="pre">--fixed</span></tt>
option, the dimensions of <img class="math" src="../_images/math/b92c09a649305a0aef3239729d93cdf941e0e5cf.png" alt="G"/> and <img class="math" src="../_images/math/9dfa31437b58c0473299320aa638151cd88cf61b.png" alt="D"/> are <img class="math" src="../_images/math/0175c52c5d6fa0ea3f70084571952b3a8bba1e88.png" alt="N_{chan} \times N_{source}"/> and <img class="math" src="../_images/math/8b26fae51911c96e440ea6b547fd8a20e1782059.png" alt="N_{chan} \times 3N_{source}"/>,
respectively. Both <img class="math" src="../_images/math/b92c09a649305a0aef3239729d93cdf941e0e5cf.png" alt="G"/> and <img class="math" src="../_images/math/9dfa31437b58c0473299320aa638151cd88cf61b.png" alt="D"/> can
be read with the mne_read_forward_solution Matlab
function, see Table 10.1.</p>
</div>
</div>
<div class="section" id="averaging-forward-solutions">
<span id="chdbbfca"></span><h2>Averaging forward solutions<a class="headerlink" href="#averaging-forward-solutions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Purpose<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>One possibility to make a grand average over several runs
of a experiment is to average the data across runs and average the
forward solutions accordingly. For this purpose, mne_average_forward_solutions computes a
weighted average of several forward solutions. The program averages both
MEG and EEG forward solutions. Usually the EEG forward solution is
identical across runs because the electrode locations do not change.</p>
</div>
<div class="section" id="id3">
<h3>Command line options<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>mne_average_forward_solutions accepts
the following command-line options:</p>
<p><strong>&#8212;version</strong></p>
<blockquote>
<div>Show the program version and compilation date.</div></blockquote>
<p><strong>&#8212;help</strong></p>
<blockquote>
<div>List the command-line options.</div></blockquote>
<p><strong>&#8212;fwd &lt;*name*&gt; :[ &lt;*weight*&gt; ]</strong></p>
<blockquote>
<div>Specifies a forward solution to include. If no weight is specified,
1.0 is assumed. In the averaging process the weights are divided
by their sum. For example, if two forward solutions are averaged
and their specified weights are 2 and 3, the average is formed with
a weight of 2/5 for the first solution and 3/5 for the second one.</div></blockquote>
<p><strong>&#8212;out &lt;*name*&gt;</strong></p>
<blockquote>
<div>Specifies the output file which will contain the averaged forward solution.</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
        &copy; Copyright 2012-2015, MNE Developers.
      Last updated on May 14, 2015.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>