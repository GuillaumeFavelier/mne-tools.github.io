

.. _sphx_glr_auto_tutorials_plot_cluster_stats_time_frequency.py:


.. _tut_stats_cluster_sensor_2samp_tfr:

=========================================================================
Non-parametric between conditions cluster statistic on single trial power
=========================================================================

This script shows how to compare clusters in time-frequency
power estimates between conditions. It uses a non-parametric
statistical procedure based on permutations and cluster
level statistics.

The procedure consists in:

  - extracting epochs for 2 conditions
  - compute single trial power estimates
  - baseline line correct the power estimates (power ratios)
  - compute stats to see if the power estimates are significantly different
    between conditions.



.. code-block:: python

    # Authors: Alexandre Gramfort <alexandre.gramfort@telecom-paristech.fr>
    #
    # License: BSD (3-clause)

    import numpy as np
    import matplotlib.pyplot as plt

    import mne
    from mne import io
    from mne.time_frequency import single_trial_power
    from mne.stats import permutation_cluster_test
    from mne.datasets import sample

    print(__doc__)




.. rst-class:: sphx-glr-horizontal





Set parameters


.. code-block:: python

    data_path = sample.data_path()
    raw_fname = data_path + '/MEG/sample/sample_audvis_raw.fif'
    event_fname = data_path + '/MEG/sample/sample_audvis_raw-eve.fif'
    event_id = 1
    tmin = -0.2
    tmax = 0.5

    # Setup for reading the raw data
    raw = io.Raw(raw_fname)
    events = mne.read_events(event_fname)

    include = []
    raw.info['bads'] += ['MEG 2443', 'EEG 053']  # bads + 2 more

    # picks MEG gradiometers
    picks = mne.pick_types(raw.info, meg='grad', eeg=False, eog=True,
                           stim=False, include=include, exclude='bads')

    ch_name = raw.info['ch_names'][picks[0]]

    # Load condition 1
    reject = dict(grad=4000e-13, eog=150e-6)
    event_id = 1
    epochs_condition_1 = mne.Epochs(raw, events, event_id, tmin, tmax,
                                    picks=picks, baseline=(None, 0),
                                    reject=reject)
    data_condition_1 = epochs_condition_1.get_data()  # as 3D matrix
    data_condition_1 *= 1e13  # change unit to fT / cm

    # Load condition 2
    event_id = 2
    epochs_condition_2 = mne.Epochs(raw, events, event_id, tmin, tmax,
                                    picks=picks, baseline=(None, 0),
                                    reject=reject)
    data_condition_2 = epochs_condition_2.get_data()  # as 3D matrix
    data_condition_2 *= 1e13  # change unit to fT / cm

    # Take only one channel
    data_condition_1 = data_condition_1[:, 97:98, :]
    data_condition_2 = data_condition_2[:, 97:98, :]

    # Time vector
    times = 1e3 * epochs_condition_1.times  # change unit to ms

    # Factor to downsample the temporal dimension of the PSD computed by
    # single_trial_power.  Decimation occurs after frequency decomposition and can
    # be used to reduce memory usage (and possibly comptuational time of downstream
    # operations such as nonparametric statistics) if you don't need high
    # spectrotemporal resolution.
    decim = 2
    frequencies = np.arange(7, 30, 3)  # define frequencies of interest
    sfreq = raw.info['sfreq']  # sampling in Hz
    n_cycles = 1.5

    epochs_power_1 = single_trial_power(data_condition_1, sfreq=sfreq,
                                        frequencies=frequencies,
                                        n_cycles=n_cycles, decim=decim)

    epochs_power_2 = single_trial_power(data_condition_2, sfreq=sfreq,
                                        frequencies=frequencies,
                                        n_cycles=n_cycles, decim=decim)

    epochs_power_1 = epochs_power_1[:, 0, :, :]  # only 1 channel to get 3D matrix
    epochs_power_2 = epochs_power_2[:, 0, :, :]  # only 1 channel to get 3D matrix

    # Compute ratio with baseline power (be sure to correct time vector with
    # decimation factor)
    baseline_mask = times[::decim] < 0
    epochs_baseline_1 = np.mean(epochs_power_1[:, :, baseline_mask], axis=2)
    epochs_power_1 /= epochs_baseline_1[..., np.newaxis]
    epochs_baseline_2 = np.mean(epochs_power_2[:, :, baseline_mask], axis=2)
    epochs_power_2 /= epochs_baseline_2[..., np.newaxis]




.. rst-class:: sphx-glr-horizontal



**Script output**:

.. rst-class:: sphx-glr-script-out

  ::

    Opening raw data file /home/jaakko/mne-testing-data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
        Read a total of 3 projection items:
            PCA-v1 (1 x 102)  idle
            PCA-v2 (1 x 102)  idle
            PCA-v3 (1 x 102)  idle
    Current compensation grade : 0
        Range : 25800 ... 192599 =     42.956 ...   320.670 secs
    Ready.
    Adding average EEG reference projection.
    1 projection items deactivated
    72 matching events found
    4 projection items activated
    Reading 2851 ... 3271  =      4.747 ...     5.446 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 4530 ... 4950  =      7.542 ...     8.242 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 6181 ... 6601  =     10.291 ...    10.990 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 7792 ... 8212  =     12.973 ...    13.673 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 9508 ... 9928  =     15.830 ...    16.530 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 11087 ... 11507  =     18.459 ...    19.159 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 12791 ... 13211  =     21.297 ...    21.996 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 14485 ... 14905  =     24.117 ...    24.816 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 16206 ... 16626  =     26.982 ...    27.682 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 17861 ... 18281  =     29.738 ...    30.437 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 19566 ... 19986  =     32.577 ...    33.276 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 21175 ... 21595  =     35.256 ...    35.955 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 22802 ... 23222  =     37.964 ...    38.664 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 24349 ... 24769  =     40.540 ...    41.239 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 25961 ... 26381  =     43.224 ...    43.923 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 27574 ... 27994  =     45.910 ...    46.609 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 29180 ... 29600  =     48.584 ...    49.283 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 30797 ... 31217  =     51.276 ...    51.975 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 32528 ... 32948  =     54.158 ...    54.857 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 34209 ... 34629  =     56.957 ...    57.656 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 35948 ... 36368  =     59.852 ...    60.551 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 37612 ... 38032  =     62.622 ...    63.322 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 39261 ... 39681  =     65.368 ...    66.067 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 41044 ... 41464  =     68.337 ...    69.036 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 42746 ... 43166  =     71.170 ...    71.870 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 44339 ... 44759  =     73.823 ...    74.522 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 46071 ... 46491  =     76.706 ...    77.406 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 47798 ... 48218  =     79.582 ...    80.281 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 50974 ... 51394  =     84.870 ...    85.569 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 52619 ... 53039  =     87.609 ...    88.308 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 54289 ... 54709  =     90.389 ...    91.088 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 55991 ... 56411  =     93.223 ...    93.922 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 57648 ... 58068  =     95.982 ...    96.681 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 59379 ... 59799  =     98.864 ...    99.563 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 61051 ... 61471  =    101.647 ...   102.347 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 62673 ... 63093  =    104.348 ...   105.047 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 64499 ... 64919  =    107.388 ...   108.088 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 66118 ... 66538  =    110.084 ...   110.783 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 67749 ... 68169  =    112.799 ...   113.499 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 69515 ... 69935  =    115.740 ...   116.439 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 71314 ... 71734  =    118.735 ...   119.434 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 72983 ... 73403  =    121.514 ...   122.213 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 74700 ... 75120  =    124.373 ...   125.072 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 76368 ... 76788  =    127.150 ...   127.849 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 78113 ... 78533  =    130.055 ...   130.754 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 79840 ... 80260  =    132.930 ...   133.630 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 81435 ... 81855  =    135.586 ...   136.285 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 84654 ... 85074  =    140.946 ...   141.645 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 86372 ... 86792  =    143.806 ...   144.505 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 88032 ... 88452  =    146.570 ...   147.269 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 89699 ... 90119  =    149.345 ...   150.045 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 91384 ... 91804  =    152.151 ...   152.850 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 92959 ... 93379  =    154.773 ...   155.472 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 94619 ... 95039  =    157.537 ...   158.236 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 96298 ... 96718  =    160.332 ...   161.032 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 98011 ... 98431  =    163.184 ...   163.884 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 99789 ... 100209  =    166.145 ...   166.844 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 101411 ... 101831  =    168.845 ...   169.545 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 103005 ... 103425  =    171.499 ...   172.198 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 104575 ... 104995  =    174.113 ...   174.812 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 106161 ... 106581  =    176.754 ...   177.453 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 109613 ... 110033  =    182.501 ...   183.201 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 111213 ... 111633  =    185.165 ...   185.864 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 112916 ... 113336  =    188.001 ...   188.700 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 114692 ... 115112  =    190.958 ...   191.657 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 118151 ... 118571  =    196.717 ...   197.416 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 119746 ... 120166  =    199.372 ...   200.072 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 121538 ... 121958  =    202.356 ...   203.055 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 123242 ... 123662  =    205.193 ...   205.892 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 124952 ... 125372  =    208.040 ...   208.739 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 126506 ... 126926  =    210.627 ...   211.327 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 128160 ... 128580  =    213.381 ...   214.081 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    16 bad epochs dropped
    73 matching events found
    4 projection items activated
    Reading 2057 ... 2477  =      3.425 ...     4.124 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 3732 ... 4152  =      6.214 ...     6.913 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 5320 ... 5740  =      8.858 ...     9.557 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 7015 ... 7435  =     11.680 ...    12.379 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 8612 ... 9032  =     14.339 ...    15.038 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 10291 ... 10711  =     17.134 ...    17.833 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 11990 ... 12410  =     19.963 ...    20.662 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 13643 ... 14063  =     22.715 ...    23.414 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 15340 ... 15760  =     25.540 ...    26.240 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 17040 ... 17460  =     28.371 ...    29.070 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 18729 ... 19149  =     31.183 ...    31.882 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 20320 ... 20740  =     33.832 ...    34.531 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 21975 ... 22395  =     36.587 ...    37.287 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 23549 ... 23969  =     39.208 ...    39.907 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 25126 ... 25546  =     41.834 ...    42.533 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 26755 ... 27175  =     44.546 ...    45.245 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 28400 ... 28820  =     47.285 ...    47.984 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 29958 ... 30378  =     49.879 ...    50.578 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 31692 ... 32112  =     52.766 ...    53.465 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 35115 ... 35535  =     58.465 ...    59.164 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 36762 ... 37182  =     61.207 ...    61.907 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 38467 ... 38887  =     64.046 ...    64.745 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 40151 ... 40571  =     66.850 ...    67.549 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 41891 ... 42311  =     69.747 ...    70.446 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 43538 ... 43958  =     72.489 ...    73.188 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 45208 ... 45628  =     75.270 ...    75.969 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 46904 ... 47324  =     78.093 ...    78.793 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 48620 ... 49040  =     80.950 ...    81.650 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 50166 ... 50586  =     83.524 ...    84.224 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 51762 ... 52182  =     86.182 ...    86.881 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 53441 ... 53861  =     88.977 ...    89.676 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 55097 ... 55517  =     91.734 ...    92.434 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 56795 ... 57215  =     94.561 ...    95.261 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 58526 ... 58946  =     97.443 ...    98.143 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 60187 ... 60607  =    100.209 ...   100.908 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 61804 ... 62224  =    102.901 ...   103.600 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 63576 ... 63996  =    105.852 ...   106.551 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 65274 ... 65694  =    108.679 ...   109.378 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 68621 ... 69041  =    114.251 ...   114.951 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 70409 ... 70829  =    117.228 ...   117.927 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 72193 ... 72613  =    120.198 ...   120.898 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 73875 ... 74295  =    122.999 ...   123.698 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 75548 ... 75968  =    125.784 ...   126.484 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 77272 ... 77692  =    128.655 ...   129.354 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 78989 ... 79409  =    131.514 ...   132.213 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 80700 ... 81120  =    134.362 ...   135.062 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 82250 ... 82670  =    136.943 ...   137.642 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 83821 ... 84241  =    139.559 ...   140.258 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 85520 ... 85940  =    142.387 ...   143.087 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 87220 ... 87640  =    145.218 ...   145.917 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 88820 ... 89240  =    147.882 ...   148.581 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 90607 ... 91027  =    150.857 ...   151.556 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 93776 ... 94196  =    156.133 ...   156.833 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 95472 ... 95892  =    158.957 ...   159.656 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 97145 ... 97565  =    161.743 ...   162.442 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 98910 ... 99330  =    164.681 ...   165.380 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 100626 ... 101046  =    167.538 ...   168.238 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 102155 ... 102575  =    170.084 ...   170.783 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 103812 ... 104232  =    172.843 ...   173.542 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 105333 ... 105753  =    175.375 ...   176.075 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    Reading 107054 ... 107474  =    178.241 ...   178.940 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 108809 ... 109229  =    181.163 ...   181.862 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 110365 ... 110785  =    183.753 ...   184.453 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 112073 ... 112493  =    186.597 ...   187.296 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 113817 ... 114237  =    189.501 ...   190.200 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 115642 ... 116062  =    192.539 ...   193.239 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 117298 ... 117718  =    195.296 ...   195.996 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 118996 ... 119416  =    198.124 ...   198.823 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 120625 ... 121045  =    200.836 ...   201.535 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 122384 ... 122804  =    203.764 ...   204.464 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 124069 ... 124489  =    206.570 ...   207.269 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 125706 ... 126126  =    209.295 ...   209.995 secs...
    [done]
    Applying baseline correction ... (mode: mean)
    Reading 127291 ... 127711  =    211.934 ...   212.634 secs...
    [done]
    Applying baseline correction ... (mode: mean)
        Rejecting  epoch based on EOG : [u'EOG 061']
    13 bad epochs dropped
    Computing time-frequency power on single epochs...
    No baseline correction applied...
    Computing time-frequency power on single epochs...
    No baseline correction applied...


Compute statistic


.. code-block:: python

    threshold = 6.0
    T_obs, clusters, cluster_p_values, H0 = \
        permutation_cluster_test([epochs_power_1, epochs_power_2],
                                 n_permutations=100, threshold=threshold, tail=0)




.. rst-class:: sphx-glr-horizontal



**Script output**:

.. rst-class:: sphx-glr-script-out

  ::

    stat_fun(H1): min=0.000000 max=18.051130
    Running intial clustering
    Found 4 clusters
    Permuting ...
    [                                        ] 1.00000 |        [............                            ] 32.00000 /        [.........................               ] 64.00000 -        [......................................  ] 96.00000 \    Computing cluster p-values
    Done.


View time-frequency plots


.. code-block:: python

    plt.clf()
    plt.subplots_adjust(0.12, 0.08, 0.96, 0.94, 0.2, 0.43)
    plt.subplot(2, 1, 1)
    evoked_contrast = np.mean(data_condition_1, 0) - np.mean(data_condition_2, 0)
    plt.plot(times, evoked_contrast.T)
    plt.title('Contrast of evoked response (%s)' % ch_name)
    plt.xlabel('time (ms)')
    plt.ylabel('Magnetic Field (fT/cm)')
    plt.xlim(times[0], times[-1])
    plt.ylim(-100, 200)

    plt.subplot(2, 1, 2)

    # Create new stats image with only significant clusters
    T_obs_plot = np.nan * np.ones_like(T_obs)
    for c, p_val in zip(clusters, cluster_p_values):
        if p_val <= 0.05:
            T_obs_plot[c] = T_obs[c]

    plt.imshow(T_obs,
               extent=[times[0], times[-1], frequencies[0], frequencies[-1]],
               aspect='auto', origin='lower', cmap='RdBu_r')
    plt.imshow(T_obs_plot,
               extent=[times[0], times[-1], frequencies[0], frequencies[-1]],
               aspect='auto', origin='lower', cmap='RdBu_r')

    plt.xlabel('time (ms)')
    plt.ylabel('Frequency (Hz)')
    plt.title('Induced power (%s)' % ch_name)
    plt.show()



.. image:: /auto_tutorials/images/sphx_glr_plot_cluster_stats_time_frequency_001.png
    :align: center




**Total running time of the script:**
(0 minutes 1.288 seconds)



**Download Python source code:** :download:`plot_cluster_stats_time_frequency.py <plot_cluster_stats_time_frequency.py>`
