

.. _sphx_glr_auto_tutorials_plot_object_epochs.py:


.. _tut_epochs_objects:

The :class:`Epochs <mne.Epochs>` data structure: epoched data
=============================================================


.. code-block:: python


    from __future__ import print_function

    import mne
    import os.path as op
    import numpy as np
    from matplotlib import pyplot as plt







:class:`Epochs <mne.Epochs>` objects are a way of representing continuous
data as a collection of time-locked trials, stored in an array of
`shape(n_events, n_channels, n_times)`. They are useful for many statistical
methods in neuroscience, and make it easy to quickly overview what occurs
during a trial.

:class:`Epochs <mne.Epochs>` objects can be created in three ways:
 1. From a :class:`Raw <mne.io.RawFIF>` object, along with event times
 2. From an :class:`Epochs <mne.Epochs>` object that has been saved as a
    `.fif` file
 3. From scratch using :class:`EpochsArray <mne.EpochsArray>`. See
    :ref:`tut_creating_data_structures`


.. code-block:: python


    data_path = mne.datasets.sample.data_path()
    # Load a dataset that contains events
    raw = mne.io.RawFIF(
        op.join(data_path, 'MEG', 'sample', 'sample_audvis_raw.fif'))

    # If your raw object has a stim channel, you can construct an event array
    # easily
    events = mne.find_events(raw, stim_channel='STI 014')

    # Show the number of events (number of rows)
    print('Number of events:', len(events))

    # Show all unique event codes (3rd column)
    print('Unique event codes:', np.unique(events[:, 2]))

    # Specify event codes of interest with descriptive labels
    event_id = dict(aud_l=1, aud_r=2, vis_l=3, vis_r=4)





.. rst-class:: sphx-glr-script-out

 Out::

    Opening raw data file /home/ubuntu/mne_data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
        Read a total of 3 projection items:
            PCA-v1 (1 x 102)  idle
            PCA-v2 (1 x 102)  idle
            PCA-v3 (1 x 102)  idle
    Current compensation grade : 0
        Range : 25800 ... 192599 =     42.956 ...   320.670 secs
    Ready.
    Adding average EEG reference projection.
    1 projection items deactivated
    320 events found
    Events id: [ 1  2  3  4  5 32]
    Number of events: 320
    Unique event codes: [ 1  2  3  4  5 32]


Now, we can create an :class:`mne.Epochs` object with the events we've
extracted. Note that epochs constructed in this manner will not have their
data available until explicitly read into memory, which you can do with
:func:`get_data <mne.Epochs.get_data>`. Alternatively, you can use
`preload=True`.

Expose the raw data as epochs, cut from -0.1 s to 1.0 s relative to the event
onsets


.. code-block:: python

    epochs = mne.Epochs(raw, events, event_id, tmin=-0.1, tmax=1,
                        baseline=(None, 0), preload=True)
    print(epochs)





.. rst-class:: sphx-glr-script-out

 Out::

    289 matching events found
    Applying baseline correction (mode: mean)
    Created an SSP operator (subspace dimension = 4)
    4 projection items activated
    Loading data for 289 events and 662 original time points ...
    0 bad epochs dropped
    <Epochs  |  n_events : 289 (all good), tmin : -0.0998976065792 (s), tmax : 1.0006410259 (s), baseline : (None, 0),
     'aud_l': 72, 'aud_r': 73, 'vis_l': 73, 'vis_r': 71>


Epochs behave similarly to :class:`mne.io.Raw` objects. They have an
:class:`info <mne.Info>` attribute that has all of the same
information, as well as a number of attributes unique to the events contained
within the object.


.. code-block:: python


    print(epochs.events[:3], epochs.event_id, sep='\n\n')





.. rst-class:: sphx-glr-script-out

 Out::

    [[27977     0     2]
     [28345     0     3]
     [28771     0     1]]

    {'aud_r': 2, 'vis_l': 3, 'vis_r': 4, 'aud_l': 1}


You can select subsets of epochs by indexing the :class:`Epochs <mne.Epochs>`
object directly. Alternatively, if you have epoch names specified in
`event_id` then you may index with strings instead.


.. code-block:: python


    print(epochs[1:5])
    print(epochs['aud_r'])





.. rst-class:: sphx-glr-script-out

 Out::

    <Epochs  |  n_events : 4 (all good), tmin : -0.0998976065792 (s), tmax : 1.0006410259 (s), baseline : (None, 0),
     'aud_l': 1, 'aud_r': 1, 'vis_l': 1, 'vis_r': 1>
    <Epochs  |  n_events : 73 (all good), tmin : -0.0998976065792 (s), tmax : 1.0006410259 (s), baseline : (None, 0)>


It is also possible to iterate through :class:`Epochs <mne.Epochs>` objects
in this way. Note that behavior is different if you iterate on `Epochs`
directly rather than indexing:


.. code-block:: python


    # These will be epochs objects
    for i in range(3):
        print(epochs[i])

    # These will be arrays
    for ep in epochs[:2]:
        print(ep)





.. rst-class:: sphx-glr-script-out

 Out::

    <Epochs  |  n_events : 1 (all good), tmin : -0.0998976065792 (s), tmax : 1.0006410259 (s), baseline : (None, 0)>
    <Epochs  |  n_events : 1 (all good), tmin : -0.0998976065792 (s), tmax : 1.0006410259 (s), baseline : (None, 0)>
    <Epochs  |  n_events : 1 (all good), tmin : -0.0998976065792 (s), tmax : 1.0006410259 (s), baseline : (None, 0)>
    [[ -1.56510152e-12  -6.00746037e-13   3.63609444e-13 ...,  -5.42252344e-12
       -3.49381248e-12   8.07845329e-12]
     [  4.71111366e-12   2.78240270e-12  -1.10663744e-13 ...,  -2.03937471e-12
       -1.07501922e-12   1.81804722e-12]
     [  1.27694161e-13   1.26810933e-13   8.74659808e-14 ...,   3.27176412e-14
        5.59107736e-14   6.80975243e-14]
     ..., 
     [  1.23131267e-06   7.56233126e-07   3.00980681e-07 ...,  -4.92607996e-06
       -5.29288884e-06  -4.96516158e-06]
     [  2.15536774e-06   2.46614632e-06   2.39846713e-06 ...,  -4.64649509e-06
       -4.75225661e-06  -4.52661069e-06]
     [  1.26772322e-05   1.26772322e-05   1.33309187e-05 ...,  -1.41239155e-05
       -1.41239155e-05  -1.15091693e-05]]
    [[  2.16584756e-12  -7.27218887e-13  -1.69157437e-12 ...,  -7.27218887e-13
       -3.62028533e-12  -1.13351292e-11]
     [ -7.11409781e-13   4.11036762e-12   2.18165666e-12 ...,   2.18165666e-12
        2.18165666e-12   2.52945700e-13]
     [ -4.30520553e-14   5.38954314e-14   1.28708120e-13 ...,  -7.19812673e-14
       -8.25595074e-14  -9.22924464e-14]
     ..., 
     [  1.42471942e-07  -6.41700502e-07  -1.84979416e-06 ...,   1.61656047e-06
        2.14156471e-06   1.65691556e-06]
     [ -1.94775057e-06  -2.25056925e-06  -2.98417563e-06 ...,   9.02345017e-07
        1.85438176e-06   6.80371054e-07]
     [ -3.42917522e-07   3.10769005e-07  -1.65029058e-06 ...,   2.27182859e-06
        1.61814206e-06  -3.42917522e-07]]


You can manually remove epochs from the Epochs object by using
:func:`epochs.drop(idx) <mne.Epochs.drop>`, or by using rejection or flat
thresholds with :func:`epochs.drop_bad(reject, flat) <mne.Epochs.drop_bad>`.
You can also inspect the reason why epochs were dropped by looking at the
list stored in ``epochs.drop_log`` or plot them with
:func:`epochs.plot_drop_log() <mne.Epochs.plot_drop_log>`. The indices
from the original set of events are stored in ``epochs.selection``.


.. code-block:: python


    epochs.drop([0], reason='User reason')
    epochs.drop_bad(reject=dict(grad=2500e-13, mag=4e-12, eog=200e-6), flat=None)
    print(epochs.drop_log)
    epochs.plot_drop_log()
    print('Selection from original events:\n%s' % epochs.selection)
    print('Removed events (from numpy setdiff1d):\n%s'
          % (np.setdiff1d(np.arange(len(events)), epochs.selection).tolist(),))
    print('Removed events (from list comprehension -- should match!):\n%s'
          % ([li for li, log in enumerate(epochs.drop_log) if len(log) > 0]))




.. image:: /auto_tutorials/images/sphx_glr_plot_object_epochs_001.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    Dropped 1 epoch
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on MAG : [u'MEG 1711']
        Rejecting  epoch based on MAG : [u'MEG 1711']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on MAG : [u'MEG 1711']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
        Rejecting  epoch based on EOG : [u'EOG 061']
    40 bad epochs dropped
    [['User reason'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], [u'EOG 061'], ['IGNORED'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [], [u'EOG 061'], [u'EOG 061'], [], [u'EOG 061'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [u'EOG 061'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [], [u'MEG 1711'], [u'MEG 1711'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [u'EOG 061'], [u'EOG 061'], [], [], [], [], [], [u'MEG 1711'], [], [], [], [], [], [], [], [u'EOG 061'], [u'EOG 061'], [], ['IGNORED'], [], ['IGNORED'], [], [u'EOG 061'], [u'EOG 061'], [], [], [], [], [], [], [u'EOG 061'], [u'EOG 061'], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [], [], [u'EOG 061', u'MEG 1421'], [], [u'EOG 061'], [], [u'EOG 061'], [], [], [], [u'EOG 061'], [u'EOG 061'], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [], [], [], [], [], [], [], [], [], [], [], [u'EOG 061', u'MEG 1421'], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [], [], [], [], [], [], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [], [], [u'EOG 061'], [u'EOG 061'], [u'EOG 061'], [], [], ['IGNORED'], ['IGNORED'], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], ['IGNORED'], ['IGNORED'], [], [u'EOG 061'], [], [], [], [], ['IGNORED']]
    Selection from original events:
    [  1   2   3   4   5   6   7   8   9  10  11  12  13  14  18  19  20  21
      22  23  24  25  26  27  28  29  30  31  32  33  34  35  38  39  42  44
      45  46  47  48  49  50  51  52  53  54  55  56  57  58  62  63  64  65
      66  67  68  69  70  71  72  73  74  75  76  77  78  81  87  88  89  90
      91  92  93  94  95  96  97  98 101 102 103 104 105 106 107 108 109 110
     111 112 113 114 115 116 117 118 121 122 125 126 127 128 129 130 131 132
     133 134 135 136 137 138 139 140 141 142 145 150 151 152 153 154 155 156
     157 158 159 160 161 162 167 168 169 170 171 173 174 175 176 177 178 179
     182 184 186 189 190 191 192 193 194 197 198 199 200 201 202 205 206 207
     209 211 213 214 215 218 219 220 221 222 223 224 225 228 229 230 231 232
     233 234 235 236 237 238 239 240 241 242 243 244 245 248 249 250 251 252
     253 254 255 256 257 258 259 261 262 263 264 265 268 269 270 271 272 273
     274 280 281 285 286 289 290 291 292 293 294 295 296 297 298 299 300 301
     302 303 304 305 306 307 308 309 310 313 315 316 317 318]
    Removed events (from numpy setdiff1d):
    [0, 15, 16, 17, 36, 37, 40, 41, 43, 59, 60, 61, 79, 80, 82, 83, 84, 85, 86, 99, 100, 119, 120, 123, 124, 143, 144, 146, 147, 148, 149, 163, 164, 165, 166, 172, 180, 181, 183, 185, 187, 188, 195, 196, 203, 204, 208, 210, 212, 216, 217, 226, 227, 246, 247, 260, 266, 267, 275, 276, 277, 278, 279, 282, 283, 284, 287, 288, 311, 312, 314, 319]
    Removed events (from list comprehension -- should match!):
    [0, 15, 16, 17, 36, 37, 40, 41, 43, 59, 60, 61, 79, 80, 82, 83, 84, 85, 86, 99, 100, 119, 120, 123, 124, 143, 144, 146, 147, 148, 149, 163, 164, 165, 166, 172, 180, 181, 183, 185, 187, 188, 195, 196, 203, 204, 208, 210, 212, 216, 217, 226, 227, 246, 247, 260, 266, 267, 275, 276, 277, 278, 279, 282, 283, 284, 287, 288, 311, 312, 314, 319]


If you wish to save the epochs as a file, you can do it with
:func:`mne.Epochs.save`. To conform to MNE naming conventions, the
epochs file names should end with '-epo.fif'.


.. code-block:: python

    epochs_fname = op.join(data_path, 'MEG', 'sample', 'sample-epo.fif')
    epochs.save(epochs_fname)







Later on you can read the epochs with :func:`mne.read_epochs`. For reading
EEGLAB epochs files see :func:`mne.read_epochs_eeglab`.


.. code-block:: python

    epochs = mne.read_epochs(epochs_fname)





.. rst-class:: sphx-glr-script-out

 Out::

    Reading /home/ubuntu/mne_data/MNE-sample-data/MEG/sample/sample-epo.fif ...
        Read a total of 4 projection items:
            PCA-v1 (1 x 102) active
            PCA-v2 (1 x 102) active
            PCA-v3 (1 x 102) active
            Average EEG reference (1 x 59) active
        Found the data of interest:
            t =     -99.90 ...    1000.64 ms (None)
            0 CTF compensation matrices available
    248 matching events found
    Applying baseline correction (mode: mean)
    Created an SSP operator (subspace dimension = 4)
    248 matching events found
    Applying baseline correction (mode: mean)
    Created an SSP operator (subspace dimension = 4)
    4 projection items activated


If you wish to look at the average across trial types, then you may do so,
creating an :class:`Evoked <mne.Evoked>` object in the process. Instances
of `Evoked` are usually created by calling :func:`mne.Epochs.average`. For
creating `Evoked` from other data structures see :class:`mne.EvokedArray` and
:ref:`tut_creating_data_structures`.


.. code-block:: python


    ev_left = epochs['aud_l'].average()
    ev_right = epochs['aud_r'].average()

    f, axs = plt.subplots(3, 2, figsize=(10, 5))
    _ = f.suptitle('Left / Right auditory', fontsize=20)
    _ = ev_left.plot(axes=axs[:, 0], show=False)
    _ = ev_right.plot(axes=axs[:, 1], show=False)
    plt.tight_layout()




.. image:: /auto_tutorials/images/sphx_glr_plot_object_epochs_002.png
    :align: center




To export and manipulate Epochs using Pandas see :ref:`tut_io_export_pandas`.

**Total running time of the script:**
(0 minutes 16.440 seconds)



.. container:: sphx-glr-download

    **Download Python source code:** :download:`plot_object_epochs.py <plot_object_epochs.py>`


.. container:: sphx-glr-download

    **Download IPython notebook:** :download:`plot_object_epochs.ipynb <plot_object_epochs.ipynb>`
