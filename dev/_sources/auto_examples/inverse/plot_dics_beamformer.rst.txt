

.. _sphx_glr_auto_examples_inverse_plot_dics_beamformer.py:


=====================================
Compute DICS beamfomer on evoked data
=====================================

Compute a Dynamic Imaging of Coherent Sources (DICS) [1]_ beamformer from
single-trial activity in a time-frequency window to estimate source time
courses based on evoked data.

References
----------
.. [1] Gross et al. Dynamic imaging of coherent sources: Studying neural
       interactions in the human brain. PNAS (2001) vol. 98 (2) pp. 694-699



.. code-block:: python

    # Author: Roman Goj <roman.goj@gmail.com>
    #         Marijn van Vliet <w.m.vanvliet@gmail.com>
    # License: BSD (3-clause)

    import mne

    import matplotlib.pyplot as plt
    import numpy as np

    from mne.datasets import sample
    from mne.time_frequency import csd_multitaper
    from mne.beamformer import dics

    print(__doc__)

    data_path = sample.data_path()
    raw_fname = data_path + '/MEG/sample/sample_audvis_raw.fif'
    event_fname = data_path + '/MEG/sample/sample_audvis_raw-eve.fif'
    fname_fwd = data_path + '/MEG/sample/sample_audvis-meg-eeg-oct-6-fwd.fif'
    label_name = 'Aud-lh'
    fname_label = data_path + '/MEG/sample/labels/%s.label' % label_name
    subjects_dir = data_path + '/subjects'







Read raw data



.. code-block:: python

    raw = mne.io.read_raw_fif(raw_fname)
    raw.info['bads'] = ['MEG 2443', 'EEG 053']  # 2 bads channels

    # Set picks
    picks = mne.pick_types(raw.info, meg=True, eeg=False, eog=False,
                           stim=False, exclude='bads')

    # Read epochs
    event_id, tmin, tmax = 1, -0.2, 0.5
    events = mne.read_events(event_fname)
    epochs = mne.Epochs(raw, events, event_id, tmin, tmax, proj=True,
                        picks=picks, baseline=(None, 0), preload=True,
                        reject=dict(grad=4000e-13, mag=4e-12))
    evoked = epochs.average()

    # Read forward operator
    forward = mne.read_forward_solution(fname_fwd)

    # Computing the data and noise cross-spectral density matrices using
    # multitapers. The time-frequency window was chosen on the basis of
    # spectrograms from example time_frequency/plot_time_frequency.py
    data_csd = csd_multitaper(epochs, tmin=0.04, tmax=0.15, fmin=6, fmax=10)
    noise_csd = csd_multitaper(epochs, tmin=-0.11, tmax=0.0, fmin=6, fmax=10)

    # Average the CSDs across the frequencies
    data_csd = data_csd.mean()
    noise_csd = noise_csd.mean()

    evoked = epochs.average()

    # Compute DICS spatial filter and estimate source time courses on evoked data
    stc = dics(evoked, forward, noise_csd, data_csd, reg=0.05)

    plt.figure()
    ts_show = -30  # show the 40 largest responses
    plt.plot(1e3 * stc.times,
             stc.data[np.argsort(stc.data.max(axis=1))[ts_show:]].T)
    plt.xlabel('Time (ms)')
    plt.ylabel('DICS value')
    plt.title('DICS time course of the 30 largest sources.')
    plt.show()

    # Plot brain in 3D with PySurfer if available
    brain = stc.plot(hemi='rh', subjects_dir=subjects_dir,
                     initial_time=0.1, time_unit='s')
    brain.show_view('lateral')

    # Uncomment to save image
    # brain.save_image('DICS_map.png')



.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /auto_examples/inverse/images/sphx_glr_plot_dics_beamformer_001.png
            :class: sphx-glr-multi-img

    *

      .. image:: /auto_examples/inverse/images/sphx_glr_plot_dics_beamformer_002.png
            :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out::

    Opening raw data file /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif...
        Read a total of 3 projection items:
            PCA-v1 (1 x 102)  idle
            PCA-v2 (1 x 102)  idle
            PCA-v3 (1 x 102)  idle
        Range : 25800 ... 192599 =     42.956 ...   320.670 secs
    Ready.
    Current compensation grade : 0
    72 matching events found
    Applying baseline correction (mode: mean)
    Not setting metadata
    Created an SSP operator (subspace dimension = 3)
    3 projection items activated
    Loading data for 72 events and 421 original time points ...
        Rejecting  epoch based on MAG : ['MEG 1711']
    1 bad epochs dropped
    Reading forward solution from /home/circleci/mne_data/MNE-sample-data/MEG/sample/sample_audvis-meg-eeg-oct-6-fwd.fif...
        Reading a source space...
        Computing patch statistics...
        Patch information added...
        Distance information added...
        [done]
        Reading a source space...
        Computing patch statistics...
        Patch information added...
        Distance information added...
        [done]
        2 source spaces read
        Desired named matrix (kind = 3523) not available
        Read MEG forward solution (7498 sources, 306 channels, free orientations)
        Desired named matrix (kind = 3523) not available
        Read EEG forward solution (7498 sources, 60 channels, free orientations)
        MEG and EEG forward solutions combined
        Source spaces transformed to the forward solution coordinate frame
        using multitaper spectrum estimation with 7 DPSS windows
    Computing cross-spectral density from epochs...
        Computing CSD matrix for epoch 1
        Computing CSD matrix for epoch 2
        Computing CSD matrix for epoch 3
        Computing CSD matrix for epoch 4
        Computing CSD matrix for epoch 5
        Computing CSD matrix for epoch 6
        Computing CSD matrix for epoch 7
        Computing CSD matrix for epoch 8
        Computing CSD matrix for epoch 9
        Computing CSD matrix for epoch 10
        Computing CSD matrix for epoch 11
        Computing CSD matrix for epoch 12
        Computing CSD matrix for epoch 13
        Computing CSD matrix for epoch 14
        Computing CSD matrix for epoch 15
        Computing CSD matrix for epoch 16
        Computing CSD matrix for epoch 17
        Computing CSD matrix for epoch 18
        Computing CSD matrix for epoch 19
        Computing CSD matrix for epoch 20
        Computing CSD matrix for epoch 21
        Computing CSD matrix for epoch 22
        Computing CSD matrix for epoch 23
        Computing CSD matrix for epoch 24
        Computing CSD matrix for epoch 25
        Computing CSD matrix for epoch 26
        Computing CSD matrix for epoch 27
        Computing CSD matrix for epoch 28
        Computing CSD matrix for epoch 29
        Computing CSD matrix for epoch 30
        Computing CSD matrix for epoch 31
        Computing CSD matrix for epoch 32
        Computing CSD matrix for epoch 33
        Computing CSD matrix for epoch 34
        Computing CSD matrix for epoch 35
        Computing CSD matrix for epoch 36
        Computing CSD matrix for epoch 37
        Computing CSD matrix for epoch 38
        Computing CSD matrix for epoch 39
        Computing CSD matrix for epoch 40
        Computing CSD matrix for epoch 41
        Computing CSD matrix for epoch 42
        Computing CSD matrix for epoch 43
        Computing CSD matrix for epoch 44
        Computing CSD matrix for epoch 45
        Computing CSD matrix for epoch 46
        Computing CSD matrix for epoch 47
        Computing CSD matrix for epoch 48
        Computing CSD matrix for epoch 49
        Computing CSD matrix for epoch 50
        Computing CSD matrix for epoch 51
        Computing CSD matrix for epoch 52
        Computing CSD matrix for epoch 53
        Computing CSD matrix for epoch 54
        Computing CSD matrix for epoch 55
        Computing CSD matrix for epoch 56
        Computing CSD matrix for epoch 57
        Computing CSD matrix for epoch 58
        Computing CSD matrix for epoch 59
        Computing CSD matrix for epoch 60
        Computing CSD matrix for epoch 61
        Computing CSD matrix for epoch 62
        Computing CSD matrix for epoch 63
        Computing CSD matrix for epoch 64
        Computing CSD matrix for epoch 65
        Computing CSD matrix for epoch 66
        Computing CSD matrix for epoch 67
        Computing CSD matrix for epoch 68
        Computing CSD matrix for epoch 69
        Computing CSD matrix for epoch 70
        Computing CSD matrix for epoch 71
    [done]
        using multitaper spectrum estimation with 7 DPSS windows
    Computing cross-spectral density from epochs...
        Computing CSD matrix for epoch 1
        Computing CSD matrix for epoch 2
        Computing CSD matrix for epoch 3
        Computing CSD matrix for epoch 4
        Computing CSD matrix for epoch 5
        Computing CSD matrix for epoch 6
        Computing CSD matrix for epoch 7
        Computing CSD matrix for epoch 8
        Computing CSD matrix for epoch 9
        Computing CSD matrix for epoch 10
        Computing CSD matrix for epoch 11
        Computing CSD matrix for epoch 12
        Computing CSD matrix for epoch 13
        Computing CSD matrix for epoch 14
        Computing CSD matrix for epoch 15
        Computing CSD matrix for epoch 16
        Computing CSD matrix for epoch 17
        Computing CSD matrix for epoch 18
        Computing CSD matrix for epoch 19
        Computing CSD matrix for epoch 20
        Computing CSD matrix for epoch 21
        Computing CSD matrix for epoch 22
        Computing CSD matrix for epoch 23
        Computing CSD matrix for epoch 24
        Computing CSD matrix for epoch 25
        Computing CSD matrix for epoch 26
        Computing CSD matrix for epoch 27
        Computing CSD matrix for epoch 28
        Computing CSD matrix for epoch 29
        Computing CSD matrix for epoch 30
        Computing CSD matrix for epoch 31
        Computing CSD matrix for epoch 32
        Computing CSD matrix for epoch 33
        Computing CSD matrix for epoch 34
        Computing CSD matrix for epoch 35
        Computing CSD matrix for epoch 36
        Computing CSD matrix for epoch 37
        Computing CSD matrix for epoch 38
        Computing CSD matrix for epoch 39
        Computing CSD matrix for epoch 40
        Computing CSD matrix for epoch 41
        Computing CSD matrix for epoch 42
        Computing CSD matrix for epoch 43
        Computing CSD matrix for epoch 44
        Computing CSD matrix for epoch 45
        Computing CSD matrix for epoch 46
        Computing CSD matrix for epoch 47
        Computing CSD matrix for epoch 48
        Computing CSD matrix for epoch 49
        Computing CSD matrix for epoch 50
        Computing CSD matrix for epoch 51
        Computing CSD matrix for epoch 52
        Computing CSD matrix for epoch 53
        Computing CSD matrix for epoch 54
        Computing CSD matrix for epoch 55
        Computing CSD matrix for epoch 56
        Computing CSD matrix for epoch 57
        Computing CSD matrix for epoch 58
        Computing CSD matrix for epoch 59
        Computing CSD matrix for epoch 60
        Computing CSD matrix for epoch 61
        Computing CSD matrix for epoch 62
        Computing CSD matrix for epoch 63
        Computing CSD matrix for epoch 64
        Computing CSD matrix for epoch 65
        Computing CSD matrix for epoch 66
        Computing CSD matrix for epoch 67
        Computing CSD matrix for epoch 68
        Computing CSD matrix for epoch 69
        Computing CSD matrix for epoch 70
        Computing CSD matrix for epoch 71
    [done]
        305 out of 366 channels remain after picking
    combining the current components...


**Total running time of the script:** ( 0 minutes  21.956 seconds)



.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_dics_beamformer.py <plot_dics_beamformer.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_dics_beamformer.ipynb <plot_dics_beamformer.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
