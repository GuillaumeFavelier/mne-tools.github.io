

.. _sphx_glr_auto_examples_inverse_plot_dipole_fit.py:


===============
Do a dipole fit
===============

This shows how to fit a dipole using mne-python.

For a comparison of fits between MNE-C and mne-python, see:

    https://gist.github.com/Eric89GXL/ca55f791200fe1dc3dd2




.. image:: /auto_examples/inverse/images/sphx_glr_plot_dipole_fit_000.png
    :align: center


**Script output**:

.. rst-class:: sphx-glr-script-out

  ::

    Reading /home/jaakko/mne-testing-data/MNE-sample-data/MEG/sample/sample_audvis-ave.fif ...
        Read a total of 4 projection items:
            PCA-v1 (1 x 102) active
            PCA-v2 (1 x 102) active
            PCA-v3 (1 x 102) active
            Average EEG reference (1 x 60) active
        Found the data of interest:
            t =    -199.80 ...     499.49 ms (Right Auditory)
            0 CTF compensation matrices available
            nave = 61 - aspect type = 100
    Projections have already been applied. Setting proj attribute to True.
    Applying baseline correction ... (mode: mean)
    BEM              : /home/jaakko/mne-testing-data/MNE-sample-data/subjects/sample/bem/sample-5120-bem-sol.fif
    MRI transform    : /home/jaakko/mne-testing-data/MNE-sample-data/MEG/sample/sample_audvis_raw-trans.fif

    Setting up the BEM model using /home/jaakko/mne-testing-data/MNE-sample-data/subjects/sample/bem/sample-5120-bem-sol.fif...

    Loading surfaces...
    Homogeneous model surface loaded.

    Loading the solution matrix...

    Loaded linear_collocation BEM solution from /home/jaakko/mne-testing-data/MNE-sample-data/subjects/sample/bem/sample-5120-bem-sol.fif
    Employing the head->MRI coordinate transform with the BEM model.
    BEM model sample-5120-bem-sol.fif is now set up

    Grid origin      :   -4.3   18.4   67.0 mm rad =   71.8 mm.
    Guess grid       :   20.0 mm
    Guess mindist    :    5.0 mm
    Guess exclude    :   20.0 mm
    Using standard MEG coil definitions.
    Noise covariance : /home/jaakko/mne-testing-data/MNE-sample-data/MEG/sample/sample_audvis-cov.fif

    Coordinate transformation: MRI (surface RAS) -> head
         0.999310  0.009985 -0.035787      -3.17 mm
         0.012759  0.812405  0.582954       6.86 mm
         0.034894 -0.583008  0.811716      28.88 mm
         0.000000  0.000000  0.000000       1.00
    Coordinate transformation: MEG device -> head
         0.991420 -0.039936 -0.124467      -6.13 mm
         0.060661  0.984012  0.167456       0.06 mm
         0.115790 -0.173570  0.977991      64.74 mm
         0.000000  0.000000  0.000000       1.00
    0 bad channels total
    Read 305 MEG channels from info
    66 coil definitions read
    Coordinate transformation: MEG device -> head
         0.991420 -0.039936 -0.124467      -6.13 mm
         0.060661  0.984012  0.167456       0.06 mm
         0.115790 -0.173570  0.977991      64.74 mm
         0.000000  0.000000  0.000000       1.00
    MEG coil definitions created in head coordinates.
    Decomposing the sensor noise covariance matrix...

    ---- Computing the forward solution for the guesses...
    Guess surface (inner_skull) is in MRI (surface RAS) coordinates
    Filtering (grid =     20 mm)...
    Surface CM = (   0.7  -10.0   44.3) mm
    Surface fits inside a sphere with radius   91.8 mm
    Surface extent:
        x =  -66.7 ...   68.8 mm
        y =  -88.0 ...   79.0 mm
        z =  -44.5 ...  105.8 mm
    Grid extent:
        x =  -80.0 ...   80.0 mm
        y = -100.0 ...   80.0 mm
        z =  -60.0 ...  120.0 mm
    900 sources before omitting any.
    396 sources after omitting infeasible sources.
    Source spaces are in MRI coordinates.
    Checking that the sources are inside the bounding surface and at least    5.0 mm away (will take a few...)
    195 source space points omitted because they are outside the inner skull surface.
    45 source space points omitted because of the    5.0-mm distance limit.
    Thank you for waiting.
    156 sources remaining after excluding the sources outside the surface and less than    5.0 mm inside.
    Go through all guess source locations...
    [done 156 sources]
    ---- Fitted :    71.6 ms, distance to inner skull : 10.5857 mm
    ---- Fitted :    73.3 ms, distance to inner skull : 10.5604 mm
    ---- Fitted :    74.9 ms, distance to inner skull : 10.2329 mm
    ---- Fitted :    76.6 ms, distance to inner skull : 10.0605 mm
    ---- Fitted :    78.3 ms, distance to inner skull : 9.7036 mm
    ---- Fitted :    79.9 ms, distance to inner skull : 9.4796 mm
    6 dipoles fitted
    Triangle file: Converted tri file nvert = 2562 ntri = 5120



.. code-block:: python

    # Author: Eric Larson <larson.eric.d@gmail.com>
    #
    # License: BSD (3-clause)

    from os import path as op

    import mne

    print(__doc__)

    data_path = mne.datasets.sample.data_path()
    subjects_dir = op.join(data_path, 'subjects')
    fname_ave = op.join(data_path, 'MEG', 'sample', 'sample_audvis-ave.fif')
    fname_cov = op.join(data_path, 'MEG', 'sample', 'sample_audvis-cov.fif')
    fname_bem = op.join(subjects_dir, 'sample', 'bem', 'sample-5120-bem-sol.fif')
    fname_trans = op.join(data_path, 'MEG', 'sample',
                          'sample_audvis_raw-trans.fif')
    fname_surf_lh = op.join(subjects_dir, 'sample', 'surf', 'lh.white')

    # Let's localize the N100m (using MEG only)
    evoked = mne.read_evokeds(fname_ave, condition='Right Auditory',
                              baseline=(None, 0))
    evoked.pick_types(meg=True, eeg=False)
    evoked.crop(0.07, 0.08)

    # Fit a dipole
    dip = mne.fit_dipole(evoked, fname_cov, fname_bem, fname_trans)[0]

    # Plot the result
    dip.plot_locations(fname_trans, 'sample', subjects_dir)

**Total running time of the script:**
(0 minutes 16.537 seconds)



**Download Python source code:** :download:`plot_dipole_fit.py <plot_dipole_fit.py>`
